"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _appiumIosDriver = require("appium-ios-driver");

var _appiumRemoteDebugger = require("appium-remote-debugger");

var _appiumBaseDriver = require("appium-base-driver");

var _appiumSupport = require("appium-support");

var _logger = _interopRequireDefault(require("../logger"));

var _asyncbox = require("asyncbox");

var _lodash = _interopRequireDefault(require("lodash"));

const WEBVIEW_BASE = `${_appiumIosDriver.WEBVIEW_WIN}_`;
let commands = {},
    helpers = {},
    extensions = {};
Object.assign(extensions, _appiumIosDriver.iosCommands.context);

extensions.closeAlertBeforeTest = async function closeAlertBeforeTest() {
  return true;
};

extensions.navToInitialWebview = async function navToInitialWebview() {
  if (this.useNewSafari()) {
    await this.typeAndNavToUrl();
  } else if (!this.isRealDevice() && this.opts.safari) {
    await this.navToViewThroughFavorites();
  } else {
    await this.navToViewWithTitle(/.*/);
  }
};

extensions.getLatestWebviewContextForTitle = async function getLatestWebviewContextForTitle(regExp) {
  const currentUrl = this.getCurrentUrl();

  const contexts = _lodash.default.filter((await this.getContextsAndViews()), 'view');

  if (currentUrl) {
    for (const ctx of contexts) {
      if ((ctx.view.url || '') === this.getCurrentUrl()) {
        return ctx.id;
      }
    }
  }

  for (const ctx of contexts) {
    if (ctx.view.title && regExp.test(ctx.view.title) || ctx.view.url && regExp.test(ctx.view.url)) {
      return ctx.id;
    }
  }
};

extensions.isWebContext = function isWebContext() {
  return !!this.curContext && this.curContext !== _appiumIosDriver.iosCommands.context.NATIVE_WIN;
};

extensions.isWebview = function isWebview() {
  return this.isWebContext();
};

extensions.getNewRemoteDebugger = async function getNewRemoteDebugger() {
  let socketPath;

  if (!this.isRealDevice()) {
    socketPath = await this.opts.device.getWebInspectorSocket();
  }

  return (0, _appiumRemoteDebugger.createRemoteDebugger)({
    bundleId: this.opts.bundleId,
    isSafari: this.isSafari(),
    includeSafari: this.opts.includeSafariInWebviews,
    useNewSafari: this.useNewSafari(),
    pageLoadMs: this.pageLoadMs,
    platformVersion: this.opts.platformVersion,
    socketPath,
    remoteDebugProxy: this.opts.remoteDebugProxy,
    garbageCollectOnExecute: _appiumSupport.util.hasValue(this.opts.safariGarbageCollect) ? !!this.opts.safariGarbageCollect : false,
    udid: this.opts.udid,
    logAllCommunication: this.opts.safariLogAllCommunication,
    logAllCommunicationHexDump: this.opts.safariLogAllCommunicationHexDump,
    socketChunkSize: this.opts.safariSocketChunkSize
  }, this.isRealDevice());
};

commands.setContext = async function setContext(name, callback, skipReadyCheck) {
  function alreadyInContext(desired, current) {
    return desired === current || desired === null && current === _appiumIosDriver.NATIVE_WIN || desired === _appiumIosDriver.NATIVE_WIN && current === null;
  }

  function isNativeContext(context) {
    return context === _appiumIosDriver.NATIVE_WIN || context === null;
  }

  _logger.default.debug(`Attempting to set context to '${name || _appiumIosDriver.NATIVE_WIN}' from '${this.curContext ? this.curContext : _appiumIosDriver.NATIVE_WIN}'`);

  if (alreadyInContext(name, this.curContext) || alreadyInContext(_lodash.default.replace(name, WEBVIEW_BASE, ''), this.curContext)) {
    _logger.default.debug(`Already in '${name || _appiumIosDriver.NATIVE_WIN}' context. Doing nothing.`);

    return;
  }

  if (isNativeContext(name)) {
    this.curContext = null;
    return;
  }

  if (_lodash.default.isUndefined(this.contexts)) {
    await this.getContexts();
  }

  let contextId = _lodash.default.replace(name, WEBVIEW_BASE, '');

  if (contextId === '') {
    contextId = this.contexts[1];
  }

  if (!_lodash.default.includes(this.contexts, contextId)) {
    throw new _appiumBaseDriver.errors.NoSuchContextError();
  }

  const oldContext = this.curContext;
  this.curContext = this.curWindowHandle = contextId;

  const [appIdKey, pageIdKey] = _lodash.default.map(contextId.split('.'), id => parseInt(id, 10));

  try {
    this.selectingNewPage = true;
    await this.remote.selectPage(appIdKey, pageIdKey, skipReadyCheck);
  } catch (err) {
    this.curContext = this.curWindowHandle = oldContext;
    throw err;
  } finally {
    this.selectingNewPage = false;
  }

  if (this.opts.enablePerformanceLogging && this.remote) {
    _logger.default.debug(`Starting performance log on '${this.curContext}'`);

    this.logs.performance = new _appiumIosDriver.IOSPerformanceLog(this.remote);
    await this.logs.performance.startCapture();
  }

  if (name && name !== _appiumIosDriver.NATIVE_WIN && this.logs) {
    if (this.logs.safariConsole) {
      await this.remote.startConsole(this.logs.safariConsole.addLogLine.bind(this.logs.safariConsole));
    }

    if (this.logs.safariNetwork) {
      await this.remote.startNetwork(this.logs.safariNetwork.addLogLine.bind(this.logs.safariNetwork));
    }
  }
};

extensions.connectToRemoteDebugger = async function connectToRemoteDebugger() {
  this.remote = await this.getNewRemoteDebugger();
  await this.remote.connect();
  this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_PAGE_CHANGE, this.onPageChange.bind(this));
  this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_FRAMES_DETACHED, () => {
    if (!_lodash.default.isEmpty(this.curWebFrames)) {
      _logger.default.debug(`Clearing ${this.curWebFrames.length} frames: ${this.curWebFrames.join(', ')}`);
    }

    this.curWebFrames = [];
  });
};

extensions.listWebFrames = async function listWebFrames(useUrl = true) {
  if (!this.opts.bundleId) {
    _logger.default.errorAndThrow('Cannot enter web frame without a bundle ID');
  }

  useUrl = useUrl && !this.isRealDevice() && !!this.getCurrentUrl();

  _logger.default.debug(`Selecting by url: ${useUrl} ${useUrl ? `(expected url: '${this.getCurrentUrl()}')` : ''}`);

  const currentUrl = useUrl ? this.getCurrentUrl() : undefined;
  let pageArray = [];

  const getWebviewPages = async () => {
    try {
      return await this.remote.selectApp(currentUrl, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
    } catch (err) {
      _logger.default.debug(`No available web pages: ${err.message}`);

      return [];
    }
  };

  if (this.remote && this.remote.appIdKey) {
    pageArray = await getWebviewPages();
  } else {
    if (this.remote) {
      await this.remote.setConnectionKey();
    } else {
      await this.connectToRemoteDebugger();
    }

    pageArray = await getWebviewPages();
    const alertErrorMsg = 'Close alert failed. Retry.';

    try {
      await (0, _asyncbox.retryInterval)(6, 1000, async () => {
        if (!(await this.closeAlertBeforeTest())) {
          throw new Error(alertErrorMsg);
        }
      });
    } catch (err) {
      if (err.message !== alertErrorMsg) {
        _logger.default.errorAndThrow(err);
      }
    }
  }

  if (pageArray.length === 0) {
    _logger.default.debug('No web frames found.');
  }

  return pageArray;
};

extensions.mobileGetContexts = async function mobileGetContexts() {
  const curOpt = this.opts.fullContextList;

  try {
    this.opts.fullContextList = true;
    return await this.getContexts();
  } finally {
    this.opts.fullContextList = curOpt;
  }
};

commands.setWindow = async function setWindow(name, skipReadyCheck) {
  try {
    await this.setContext(name, _lodash.default.noop, skipReadyCheck);
  } catch (err) {
    throw (0, _appiumBaseDriver.isErrorType)(err, _appiumBaseDriver.errors.NoSuchContextError) ? new _appiumBaseDriver.errors.NoSuchWindowError() : err;
  }
};

commands.getWindowHandle = async function getWindowHandle() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  _logger.default.debug(`Getting current window handle`);

  return this.curContext;
};

commands.getWindowHandles = async function getWindowHandles() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  _logger.default.debug('Getting list of available window handles');

  const contexts = await this.getContextsAndViews(false);
  return contexts.filter(context => context.id !== _appiumIosDriver.NATIVE_WIN).map(context => context.view.id.toString());
};

extensions.onPageChange = async function onPageChange(pageChangeNotification) {
  _logger.default.debug(`Remote debugger notified us of a new page listing: ${JSON.stringify(pageChangeNotification)}`);

  if (this.selectingNewPage) {
    _logger.default.debug('We are in the middle of selecting a page, ignoring');

    return;
  }

  if (!this.remote || !this.remote.isConnected()) {
    _logger.default.debug('We have not yet connected, ignoring');

    return;
  }

  const {
    appIdKey,
    pageArray
  } = pageChangeNotification;
  let newIds = [];
  let newPages = [];
  let keyId = null;

  for (const page of pageArray) {
    const id = page.id.toString();
    newIds.push(id);

    if (page.isKey) {
      keyId = id;
    }

    const contextId = `${appIdKey}.${id}`;

    if (!_lodash.default.includes(this.contexts, contextId)) {
      newPages.push(id);
      this.contexts.push(contextId);
    }
  }

  if (!keyId) {
    _logger.default.debug('No key id found. Choosing first id from page array');

    keyId = newIds[0] || null;
  }

  if (!_appiumSupport.util.hasValue(this.curContext)) {
    _logger.default.debug('We do not appear to have window set yet, ignoring');

    return;
  }

  const [curAppIdKey, curPageIdKey] = this.curContext.split('.');

  if (curAppIdKey !== appIdKey) {
    _logger.default.debug('Page change not referring to currently selected app, ignoring.');

    return;
  }

  let newPage = null;

  if (newPages.length) {
    newPage = _lodash.default.last(newPages);

    _logger.default.debug(`We have new pages, selecting page '${newPage}'`);
  } else if (!_lodash.default.includes(newIds, curPageIdKey)) {
    _logger.default.debug('New page listing from remote debugger does not contain ' + 'current window; assuming it is closed');

    if (!_appiumSupport.util.hasValue(keyId)) {
      _logger.default.error('Do not have our current window anymore, and there ' + 'are not any more to load! Doing nothing...');

      this.setCurrentUrl(undefined);
      return;
    }

    _logger.default.debug(`Debugger already selected page '${keyId}', ` + `confirming that choice.`);

    this.curContext = `${appIdKey}.${keyId}`;
    newPage = keyId;
  } else {
    _logger.default.debug('Checking if page needs to load');

    const needsPageLoad = (() => {
      const contextArray = _lodash.default.map(pageArray, page => `${appIdKey}.${page.id}`);

      return !_lodash.default.isEqual(_lodash.default.find(this.contexts, this.curContext), _lodash.default.find(contextArray, this.curContext));
    })();

    if (needsPageLoad) {
      _logger.default.debug('Page load needed. Loading...');

      await this.remote.pageLoad();
    }

    _logger.default.debug('New page listing is same as old, doing nothing');
  }

  if (_appiumSupport.util.hasValue(this.curContext)) {
    let currentPageId = parseInt(_lodash.default.last(this.curContext.split('.')), 10);

    let page = _lodash.default.find(pageArray, p => parseInt(p.id, 10) === currentPageId);

    if (page && page.url !== this.getCurrentUrl()) {
      _logger.default.debug(`Redirected from '${this.getCurrentUrl()}' to '${page.url}'`);

      this.setCurrentUrl(page.url);
    }
  }

  if (_appiumSupport.util.hasValue(newPage)) {
    this.selectingNewPage = true;
    const oldContext = this.curContext;
    this.curContext = `${appIdKey}.${newPage}`;
    this.remote.selectPage(appIdKey, parseInt(newPage, 10)).catch(err => {
      _logger.default.warn(`Failed to select page: ${err.message}`);

      this.curContext = oldContext;
    });
    this.selectingNewPage = false;
  }

  this.windowHandleCache = pageArray;
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9jb250ZXh0LmpzIl0sIm5hbWVzIjpbIldFQlZJRVdfQkFTRSIsIldFQlZJRVdfV0lOIiwiY29tbWFuZHMiLCJoZWxwZXJzIiwiZXh0ZW5zaW9ucyIsIk9iamVjdCIsImFzc2lnbiIsImlvc0NvbW1hbmRzIiwiY29udGV4dCIsImNsb3NlQWxlcnRCZWZvcmVUZXN0IiwibmF2VG9Jbml0aWFsV2VidmlldyIsInVzZU5ld1NhZmFyaSIsInR5cGVBbmROYXZUb1VybCIsImlzUmVhbERldmljZSIsIm9wdHMiLCJzYWZhcmkiLCJuYXZUb1ZpZXdUaHJvdWdoRmF2b3JpdGVzIiwibmF2VG9WaWV3V2l0aFRpdGxlIiwiZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZSIsInJlZ0V4cCIsImN1cnJlbnRVcmwiLCJnZXRDdXJyZW50VXJsIiwiY29udGV4dHMiLCJfIiwiZmlsdGVyIiwiZ2V0Q29udGV4dHNBbmRWaWV3cyIsImN0eCIsInZpZXciLCJ1cmwiLCJpZCIsInRpdGxlIiwidGVzdCIsImlzV2ViQ29udGV4dCIsImN1ckNvbnRleHQiLCJOQVRJVkVfV0lOIiwiaXNXZWJ2aWV3IiwiZ2V0TmV3UmVtb3RlRGVidWdnZXIiLCJzb2NrZXRQYXRoIiwiZGV2aWNlIiwiZ2V0V2ViSW5zcGVjdG9yU29ja2V0IiwiYnVuZGxlSWQiLCJpc1NhZmFyaSIsImluY2x1ZGVTYWZhcmkiLCJpbmNsdWRlU2FmYXJpSW5XZWJ2aWV3cyIsInBhZ2VMb2FkTXMiLCJwbGF0Zm9ybVZlcnNpb24iLCJyZW1vdGVEZWJ1Z1Byb3h5IiwiZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUiLCJ1dGlsIiwiaGFzVmFsdWUiLCJzYWZhcmlHYXJiYWdlQ29sbGVjdCIsInVkaWQiLCJsb2dBbGxDb21tdW5pY2F0aW9uIiwic2FmYXJpTG9nQWxsQ29tbXVuaWNhdGlvbiIsImxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wIiwic2FmYXJpTG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXAiLCJzb2NrZXRDaHVua1NpemUiLCJzYWZhcmlTb2NrZXRDaHVua1NpemUiLCJzZXRDb250ZXh0IiwibmFtZSIsImNhbGxiYWNrIiwic2tpcFJlYWR5Q2hlY2siLCJhbHJlYWR5SW5Db250ZXh0IiwiZGVzaXJlZCIsImN1cnJlbnQiLCJpc05hdGl2ZUNvbnRleHQiLCJsb2ciLCJkZWJ1ZyIsInJlcGxhY2UiLCJpc1VuZGVmaW5lZCIsImdldENvbnRleHRzIiwiY29udGV4dElkIiwiaW5jbHVkZXMiLCJlcnJvcnMiLCJOb1N1Y2hDb250ZXh0RXJyb3IiLCJvbGRDb250ZXh0IiwiY3VyV2luZG93SGFuZGxlIiwiYXBwSWRLZXkiLCJwYWdlSWRLZXkiLCJtYXAiLCJzcGxpdCIsInBhcnNlSW50Iiwic2VsZWN0aW5nTmV3UGFnZSIsInJlbW90ZSIsInNlbGVjdFBhZ2UiLCJlcnIiLCJlbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmciLCJsb2dzIiwicGVyZm9ybWFuY2UiLCJJT1NQZXJmb3JtYW5jZUxvZyIsInN0YXJ0Q2FwdHVyZSIsInNhZmFyaUNvbnNvbGUiLCJzdGFydENvbnNvbGUiLCJhZGRMb2dMaW5lIiwiYmluZCIsInNhZmFyaU5ldHdvcmsiLCJzdGFydE5ldHdvcmsiLCJjb25uZWN0VG9SZW1vdGVEZWJ1Z2dlciIsImNvbm5lY3QiLCJvbiIsIlJlbW90ZURlYnVnZ2VyIiwiRVZFTlRfUEFHRV9DSEFOR0UiLCJvblBhZ2VDaGFuZ2UiLCJFVkVOVF9GUkFNRVNfREVUQUNIRUQiLCJpc0VtcHR5IiwiY3VyV2ViRnJhbWVzIiwibGVuZ3RoIiwiam9pbiIsImxpc3RXZWJGcmFtZXMiLCJ1c2VVcmwiLCJlcnJvckFuZFRocm93IiwidW5kZWZpbmVkIiwicGFnZUFycmF5IiwiZ2V0V2Vidmlld1BhZ2VzIiwic2VsZWN0QXBwIiwid2Vidmlld0Nvbm5lY3RSZXRyaWVzIiwiaWdub3JlQWJvdXRCbGFua1VybCIsIm1lc3NhZ2UiLCJzZXRDb25uZWN0aW9uS2V5IiwiYWxlcnRFcnJvck1zZyIsIkVycm9yIiwibW9iaWxlR2V0Q29udGV4dHMiLCJjdXJPcHQiLCJmdWxsQ29udGV4dExpc3QiLCJzZXRXaW5kb3ciLCJub29wIiwiTm9TdWNoV2luZG93RXJyb3IiLCJnZXRXaW5kb3dIYW5kbGUiLCJOb3RJbXBsZW1lbnRlZEVycm9yIiwiZ2V0V2luZG93SGFuZGxlcyIsInRvU3RyaW5nIiwicGFnZUNoYW5nZU5vdGlmaWNhdGlvbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJpc0Nvbm5lY3RlZCIsIm5ld0lkcyIsIm5ld1BhZ2VzIiwia2V5SWQiLCJwYWdlIiwicHVzaCIsImlzS2V5IiwiY3VyQXBwSWRLZXkiLCJjdXJQYWdlSWRLZXkiLCJuZXdQYWdlIiwibGFzdCIsImVycm9yIiwic2V0Q3VycmVudFVybCIsIm5lZWRzUGFnZUxvYWQiLCJjb250ZXh0QXJyYXkiLCJpc0VxdWFsIiwiZmluZCIsInBhZ2VMb2FkIiwiY3VycmVudFBhZ2VJZCIsInAiLCJjYXRjaCIsIndhcm4iLCJ3aW5kb3dIYW5kbGVDYWNoZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxZQUFZLEdBQUksR0FBRUMsNEJBQVksR0FBcEM7QUFFQSxJQUFJQyxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFBVSxHQUFHLEVBQTlDO0FBRUFDLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjRixVQUFkLEVBQTBCRyw2QkFBWUMsT0FBdEM7O0FBR0FKLFVBQVUsQ0FBQ0ssb0JBQVgsR0FBa0MsZUFBZUEsb0JBQWYsR0FBdUM7QUFDdkUsU0FBTyxJQUFQO0FBQ0QsQ0FGRDs7QUFNQUwsVUFBVSxDQUFDTSxtQkFBWCxHQUFpQyxlQUFlQSxtQkFBZixHQUFzQztBQUNyRSxNQUFJLEtBQUtDLFlBQUwsRUFBSixFQUF5QjtBQUN2QixVQUFNLEtBQUtDLGVBQUwsRUFBTjtBQUNELEdBRkQsTUFFTyxJQUFJLENBQUMsS0FBS0Ms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SCxhQUFoRCxDQUFYOztBQUNBLFFBQUlkLElBQUksSUFBSUEsSUFBSSxDQUFDOUcsR0FBTCxLQUFhLEtBQUtQLGFBQUwsRUFBekIsRUFBK0M7QUFDN0M2QyxzQkFBSUMsS0FBSixDQUFXLG9CQUFtQixLQUFLOUMsYUFBTCxFQUFxQixTQUFRcUgsSUFBSSxDQUFDOUcsR0FBSSxHQUFwRTs7QUFDQSxXQUFLc0gsYUFBTCxDQUFtQlIsSUFBSSxDQUFDOUcsR0FBeEI7QUFDRDtBQUNGOztBQUVELE1BQUlvQixvQkFBS0MsUUFBTCxDQUFjOEYsT0FBZCxDQUFKLEVBQTRCO0FBQzFCLFNBQUs3RCxnQkFBTCxHQUF3QixJQUF4QjtBQUNBLFVBQU1QLFVBQVUsR0FBRyxLQUFLMUMsVUFBeEI7QUFDQSxTQUFLQSxVQUFMLEdBQW1CLEdBQUU0QyxRQUFTLElBQUdrRSxPQUFRLEVBQXpDO0FBRUEsU0FBSzVELE1BQUwsQ0FBWUMsVUFBWixDQUF1QlAsUUFBdkIsRUFBaUNJLFFBQVEsQ0FBQzhELE9BQUQsRUFBVSxFQUFWLENBQXpDLEVBQ0dXLEtBREgsQ0FDVXJFLEdBQUQsSUFBUztBQUNkbkIsc0JBQUl5RixJQUFKLENBQVUsMEJBQXlCdEUsR0FBRyxDQUFDZ0MsT0FBUSxFQUEvQzs7QUFDQSxXQUFLcEYsVUFBTCxHQUFrQjBDLFVBQWxCO0FBQ0QsS0FKSDtBQUtBLFNBQUtPLGdCQUFMLEdBQXdCLEtBQXhCO0FBQ0Q7O0FBQ0QsT0FBSzBFLGlCQUFMLEdBQXlCNUMsU0FBekI7QUFDRCxDQWhIRDs7QUFtSEEzRyxNQUFNLENBQUNDLE1BQVAsQ0FBY0YsVUFBZCxFQUEwQkYsUUFBMUIsRUFBb0NDLE9BQXBDO2VBQ2VDLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpb3NDb21tYW5kcywgSU9TUGVyZm9ybWFuY2VMb2csIE5BVElWRV9XSU4sIFdFQlZJRVdfV0lOIH0gZnJvbSAnYXBwaXVtLWlvcy1kcml2ZXInO1xuaW1wb3J0IHsgY3JlYXRlUmVtb3RlRGVidWdnZXIsIFJlbW90ZURlYnVnZ2VyIH0gZnJvbSAnYXBwaXVtLXJlbW90ZS1kZWJ1Z2dlcic7XG5pbXBvcnQgeyBlcnJvcnMsIGlzRXJyb3JUeXBlIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5pbXBvcnQgeyByZXRyeUludGVydmFsIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuXG5jb25zdCBXRUJWSUVXX0JBU0UgPSBgJHtXRUJWSUVXX1dJTn1fYDtcblxubGV0IGNvbW1hbmRzID0ge30sIGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGlvc0NvbW1hbmRzLmNvbnRleHQpO1xuXG4vLyBvdmVycmlkZSwgYXMgYXBwaXVtLWlvcy1kcml2ZXIncyB2ZXJzaW9uIHVzZXMgVUkgQXV0b21hdGlvbiB0byBjbG9zZVxuZXh0ZW5zaW9ucy5jbG9zZUFsZXJ0QmVmb3JlVGVzdCA9IGFzeW5jIGZ1bmN0aW9uIGNsb3NlQWxlcnRCZWZvcmVUZXN0ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gIHJldHVybiB0cnVlO1xufTtcblxuLy8gdGhlIGFwcGl1bS1pb3MtZHJpdmVyIHZlcnNpb24gaGFzIGEgd2FpdCBvbiByZWFsIGRldmljZXMsIHdoaWNoIGlzIG5vIGxvbmdlclxuLy8gbmVjZXNzYXJ5XG5leHRlbnNpb25zLm5hdlRvSW5pdGlhbFdlYnZpZXcgPSBhc3luYyBmdW5jdGlvbiBuYXZUb0luaXRpYWxXZWJ2aWV3ICgpIHtcbiAgaWYgKHRoaXMudXNlTmV3U2FmYXJpKCkpIHtcbiAgICBhd2FpdCB0aGlzLnR5cGVBbmROYXZUb1VybCgpO1xuICB9IGVsc2UgaWYgKCF0aGlzLmlzUmVhbERldmljZSgpICYmIHRoaXMub3B0cy5zYWZhcmkpIHtcbiAgICBhd2FpdCB0aGlzLm5hdlRvVmlld1Rocm91Z2hGYXZvcml0ZXMoKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCB0aGlzLm5hdlRvVmlld1dpdGhUaXRsZSgvLiovKTtcbiAgfVxufTtcblxuLy8gdGhlIGFwcGl1bS1pb3MtZHJpdmVyIHZlcnNpb24gb2YgdGhpcyBmdW5jdGlvbiBmYWlscyBpbiBDSSxcbi8vIGFuZCB0aGUgd3Jvbmcgd2VidmlldyBpcyBhbG1vc3QgYWx3YXlzIHJldHJpZXZlZFxuLy8gYWxzbyBvdmVycmlkZSBzbyB0aGF0IHRoZSBjYXNlIHdoZXJlIHRoZSBTREsgdmVyc2lvbiBpcyBub3Qgc2V0IGRvZXMgbm90IGZhaWxcbmV4dGVuc2lvbnMuZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZSA9IGFzeW5jIGZ1bmN0aW9uIGdldExhdGVzdFdlYnZpZXdDb250ZXh0Rm9yVGl0bGUgKHJlZ0V4cCkge1xuICBjb25zdCBjdXJyZW50VXJsID0gdGhpcy5nZXRDdXJyZW50VXJsKCk7XG5cbiAgY29uc3QgY29udGV4dHMgPSBfLmZpbHRlcihhd2FpdCB0aGlzLmdldENvbnRleHRzQW5kVmlld3MoKSwgJ3ZpZXcnKTtcblxuICBpZiAoY3VycmVudFVybCkge1xuICAgIC8vIGZpcnN0IHRyeSB0byBtYXRjaCBieSBjdXJyZW50IHVybFxuICAgIGZvciAoY29uc3QgY3R4IG9mIGNvbnRleHRzKSB7XG4gICAgICBpZiAoKGN0eC52aWV3LnVybCB8fCAnJykgPT09IHRoaXMuZ2V0Q3VycmVudFVybCgpKSB7XG4gICAgICAgIHJldHVybiBjdHguaWQ7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gaWYgbm90LCB0cnkgdG8gbWF0Y2ggYnkgcmVndWxhciBleHByZXNzaW9uXG4gIGZvciAoY29uc3QgY3R4IG9mIGNvbnRleHRzKSB7XG4gICAgaWYgKChjdHgudmlldy50aXRsZSAmJiByZWdFeHAudGVzdChjdHgudmlldy50aXRsZSkpIHx8IChjdHgudmlldy51cmwgJiYgcmVnRXhwLnRlc3QoY3R4LnZpZXcudXJsKSkpIHtcbiAgICAgIHJldHVybiBjdHguaWQ7XG4gICAgfVxuICB9XG59O1xuXG5leHRlbnNpb25zLmlzV2ViQ29udGV4dCA9IGZ1bmN0aW9uIGlzV2ViQ29udGV4dCAoKSB7XG4gIHJldHVybiAhIXRoaXMuY3VyQ29udGV4dCAmJiB0aGlzLmN1ckNvbnRleHQgIT09IGlvc0NvbW1hbmRzLmNvbnRleHQuTkFUSVZFX1dJTjtcbn07XG5cbmV4dGVuc2lvbnMuaXNXZWJ2aWV3ID0gZnVuY3Rpb24gaXNXZWJ2aWV3ICgpIHtcbiAgcmV0dXJuIHRoaXMuaXNXZWJDb250ZXh0KCk7XG59O1xuXG5leHRlbnNpb25zLmdldE5ld1JlbW90ZURlYnVnZ2VyID0gYXN5bmMgZnVuY3Rpb24gZ2V0TmV3UmVtb3RlRGVidWdnZXIgKCkge1xuICBsZXQgc29ja2V0UGF0aDtcbiAgaWYgKCF0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgc29ja2V0UGF0aCA9IGF3YWl0IHRoaXMub3B0cy5kZXZpY2UuZ2V0V2ViSW5zcGVjdG9yU29ja2V0KCk7XG4gIH1cbiAgcmV0dXJuIGNyZWF0ZVJlbW90ZURlYnVnZ2VyKHtcbiAgICBidW5kbGVJZDogdGhpcy5vcHRzLmJ1bmRsZUlkLFxuICAgIGlzU2FmYXJpOiB0aGlzLmlzU2FmYXJpKCksXG4gICAgaW5jbHVkZVNhZmFyaTogdGhpcy5vcHRzLmluY2x1ZGVTYWZhcmlJbldlYnZpZXdzLFxuICAgIHVzZU5ld1NhZmFyaTogdGhpcy51c2VOZXdTYWZhcmkoKSxcbiAgICBwYWdlTG9hZE1zOiB0aGlzLnBhZ2VMb2FkTXMsXG4gICAgcGxhdGZvcm1WZXJzaW9uOiB0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uLFxuICAgIHNvY2tldFBhdGgsXG4gICAgcmVtb3RlRGVidWdQcm94eTogdGhpcy5vcHRzLnJlbW90ZURlYnVnUHJveHksXG4gICAgZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGU6IHV0aWwuaGFzVmFsdWUodGhpcy5vcHRzLnNhZmFyaUdhcmJhZ2VDb2xsZWN0KVxuICAgICAgPyAhIXRoaXMub3B0cy5zYWZhcmlHYXJiYWdlQ29sbGVjdFxuICAgICAgOiBmYWxzZSxcbiAgICB1ZGlkOiB0aGlzLm9wdHMudWRpZCxcbiAgICBsb2dBbGxDb21tdW5pY2F0aW9uOiB0aGlzLm9wdHMuc2FmYXJpTG9nQWxsQ29tbXVuaWNhdGlvbixcbiAgICBsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcDogdGhpcy5vcHRzLnNhZmFyaUxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wLFxuICAgIHNvY2tldENodW5rU2l6ZTogdGhpcy5vcHRzLnNhZmFyaVNvY2tldENodW5rU2l6ZSxcbiAgfSwgdGhpcy5pc1JlYWxEZXZpY2UoKSk7XG59O1xuXG4vKipcbiAqIFNldCBjb250ZXh0XG4gKlxuICogQHBhcmFtIHs/c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgY29udGV4dCB0byBzZXQuIEl0IGNvdWxkIGJlICdudWxsJyBhcyBOQVRJVkVfV0lOLlxuICogQHBhcmFtIHtjYWxsYmFja30gY2FsbGJhY2sgVGhlIGNhbGxiYWNrLiAoSXQgaXMgbm90IGNhbGxlZCBpbiB0aGlzIG1ldGhvZClcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gc2tpcFJlYWR5Q2hlY2sgLSBXaGV0aGVyIGl0IHdhaXRzIGZvciB0aGUgbmV3IGNvbnRleHQgaXMgcmVhZHlcbiAqL1xuY29tbWFuZHMuc2V0Q29udGV4dCA9IGFzeW5jIGZ1bmN0aW9uIHNldENvbnRleHQgKG5hbWUsIGNhbGxiYWNrLCBza2lwUmVhZHlDaGVjaykge1xuICBmdW5jdGlvbiBhbHJlYWR5SW5Db250ZXh0IChkZXNpcmVkLCBjdXJyZW50KSB7XG4gICAgcmV0dXJuIChkZXNpcmVkID09PSBjdXJyZW50IHx8XG4gICAgICAgICAgIChkZXNpcmVkID09PSBudWxsICYmIGN1cnJlbnQgPT09IE5BVElWRV9XSU4pIHx8XG4gICAgICAgICAgIChkZXNpcmVkID09PSBOQVRJVkVfV0lOICYmIGN1cnJlbnQgPT09IG51bGwpKTtcbiAgfVxuICBmdW5jdGlvbiBpc05hdGl2ZUNvbnRleHQgKGNvbnRleHQpIHtcbiAgICByZXR1cm4gY29udGV4dCA9PT0gTkFUSVZFX1dJTiB8fCBjb250ZXh0ID09PSBudWxsO1xuICB9XG5cbiAgbG9nLmRlYnVnKGBBdHRlbXB0aW5nIHRvIHNldCBjb250ZXh0IHRvICcke25hbWUgfHwgTkFUSVZFX1dJTn0nIGZyb20gJyR7dGhpcy5jdXJDb250ZXh0ID8gdGhpcy5jdXJDb250ZXh0IDogTkFUSVZFX1dJTn0nYCk7XG5cbiAgaWYgKGFscmVhZHlJbkNvbnRleHQobmFtZSwgdGhpcy5jdXJDb250ZXh0KSB8fCBhbHJlYWR5SW5Db250ZXh0KF8ucmVwbGFjZShuYW1lLCBXRUJWSUVXX0JBU0UsICcnKSwgdGhpcy5jdXJDb250ZXh0KSkge1xuICAgIC8vIGFscmVhZHkgaW4gdGhlIG5hbWVkIGNvbnRleHQsIG5vIG5lZWQgdG8gZG8gYW55dGhpbmdcbiAgICBsb2cuZGVidWcoYEFscmVhZHkgaW4gJyR7bmFtZSB8fCBOQVRJVkVfV0lOfScgY29udGV4dC4gRG9pbmcgbm90aGluZy5gKTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKGlzTmF0aXZlQ29udGV4dChuYW1lKSkge1xuICAgIC8vIHN3aXRjaGluZyBpbnRvIHRoZSBuYXRpdmUgY29udGV4dFxuICAgIHRoaXMuY3VyQ29udGV4dCA9IG51bGw7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gc3dpdGNoaW5nIGludG8gYSB3ZWJ2aWV3IGNvbnRleHRcblxuICAvLyBpZiBjb250ZXh0cyBoYXZlIG5vdCBhbHJlYWR5IGJlZW4gcmV0cmlldmVkLCBnZXQgdGhlbVxuICBpZiAoXy5pc1VuZGVmaW5lZCh0aGlzLmNvbnRleHRzKSkge1xuICAgIGF3YWl0IHRoaXMuZ2V0Q29udGV4dHMoKTtcbiAgfVxuXG4gIGxldCBjb250ZXh0SWQgPSBfLnJlcGxhY2UobmFtZSwgV0VCVklFV19CQVNFLCAnJyk7XG4gIGlmIChjb250ZXh0SWQgPT09ICcnKSB7XG4gICAgLy8gYWxsb3cgdXNlciB0byBwYXNzIGluIFwiV0VCVklFV1wiIHdpdGhvdXQgYW4gaW5kZXhcbiAgICAvLyB0aGUgc2Vjb25kIGNvbnRleHQgd2lsbCBiZSB0aGUgZmlyc3Qgd2VidmlldyBhc1xuICAgIC8vIHRoZSBmaXJzdCBpcyBhbHdheXMgTkFUSVZFX0FQUFxuICAgIGNvbnRleHRJZCA9IHRoaXMuY29udGV4dHNbMV07XG4gIH1cbiAgaWYgKCFfLmluY2x1ZGVzKHRoaXMuY29udGV4dHMsIGNvbnRleHRJZCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaENvbnRleHRFcnJvcigpO1xuICB9XG5cbiAgY29uc3Qgb2xkQ29udGV4dCA9IHRoaXMuY3VyQ29udGV4dDtcbiAgdGhpcy5jdXJDb250ZXh0ID0gdGhpcy5jdXJXaW5kb3dIYW5kbGUgPSBjb250ZXh0SWQ7XG5cbiAgLy8gYGNvbnRleHRJZGAgd2lsbCBiZSBpbiB0aGUgZm9ybSBvZiBgYXBwSWQucGFnZUlkYCBpbiB0aGlzIGNhc2VcbiAgY29uc3QgW2FwcElkS2V5LCBwYWdlSWRLZXldID0gXy5tYXAoY29udGV4dElkLnNwbGl0KCcuJyksIChpZCkgPT4gcGFyc2VJbnQoaWQsIDEwKSk7XG4gIHRyeSB7XG4gICAgdGhpcy5zZWxlY3RpbmdOZXdQYWdlID0gdHJ1ZTtcbiAgICBhd2FpdCB0aGlzLnJlbW90ZS5zZWxlY3RQYWdlKGFwcElkS2V5LCBwYWdlSWRLZXksIHNraXBSZWFkeUNoZWNrKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gdGhpcy5jdXJXaW5kb3dIYW5kbGUgPSBvbGRDb250ZXh0O1xuICAgIHRocm93IGVycjtcbiAgfSBmaW5hbGx5IHtcbiAgICB0aGlzLnNlbGVjdGluZ05ld1BhZ2UgPSBmYWxzZTtcbiAgfVxuXG4gIC8vIGF0dGVtcHQgdG8gc3RhcnQgcGVyZm9ybWFuY2UgbG9nZ2luZywgaWYgcmVxdWVzdGVkXG4gIGlmICh0aGlzLm9wdHMuZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nICYmIHRoaXMucmVtb3RlKSB7XG4gICAgbG9nLmRlYnVnKGBTdGFydGluZyBwZXJmb3JtYW5jZSBsb2cgb24gJyR7dGhpcy5jdXJDb250ZXh0fSdgKTtcbiAgICB0aGlzLmxvZ3MucGVyZm9ybWFuY2UgPSBuZXcgSU9TUGVyZm9ybWFuY2VMb2codGhpcy5yZW1vdGUpO1xuICAgIGF3YWl0IHRoaXMubG9ncy5wZXJmb3JtYW5jZS5zdGFydENhcHR1cmUoKTtcbiAgfVxuXG4gIC8vIHN0YXJ0IHNhZmFyaSBsb2dnaW5nIGlmIHRoZSBsb2dzIGhhbmRsZXJzIGFyZSBhY3RpdmVcbiAgaWYgKG5hbWUgJiYgbmFtZSAhPT0gTkFUSVZFX1dJTiAmJiB0aGlzLmxvZ3MpIHtcbiAgICBpZiAodGhpcy5sb2dzLnNhZmFyaUNvbnNvbGUpIHtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLnN0YXJ0Q29uc29sZSh0aGlzLmxvZ3Muc2FmYXJpQ29uc29sZS5hZGRMb2dMaW5lLmJpbmQodGhpcy5sb2dzLnNhZmFyaUNvbnNvbGUpKTtcbiAgICB9XG4gICAgaWYgKHRoaXMubG9ncy5zYWZhcmlOZXR3b3JrKSB7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5zdGFydE5ldHdvcmsodGhpcy5sb2dzLnNhZmFyaU5ldHdvcmsuYWRkTG9nTGluZS5iaW5kKHRoaXMubG9ncy5zYWZhcmlOZXR3b3JrKSk7XG4gICAgfVxuICB9XG59O1xuXG5leHRlbnNpb25zLmNvbm5lY3RUb1JlbW90ZURlYnVnZ2VyID0gYXN5bmMgZnVuY3Rpb24gY29ubmVjdFRvUmVtb3RlRGVidWdnZXIgKCkge1xuICB0aGlzLnJlbW90ZSA9IGF3YWl0IHRoaXMuZ2V0TmV3UmVtb3RlRGVidWdnZXIoKTtcbiAgYXdhaXQgdGhpcy5yZW1vdGUuY29ubmVjdCgpO1xuXG4gIHRoaXMucmVtb3RlLm9uKFJlbW90ZURlYnVnZ2VyLkVWRU5UX1BBR0VfQ0hBTkdFLCB0aGlzLm9uUGFnZUNoYW5nZS5iaW5kKHRoaXMpKTtcbiAgdGhpcy5yZW1vdGUub24oUmVtb3RlRGVidWdnZXIuRVZFTlRfRlJBTUVTX0RFVEFDSEVELCAoKSA9PiB7XG4gICAgaWYgKCFfLmlzRW1wdHkodGhpcy5jdXJXZWJGcmFtZXMpKSB7XG4gICAgICBsb2cuZGVidWcoYENsZWFyaW5nICR7dGhpcy5jdXJXZWJGcmFtZXMubGVuZ3RofSBmcmFtZXM6ICR7dGhpcy5jdXJXZWJGcmFtZXMuam9pbignLCAnKX1gKTtcbiAgICB9XG4gICAgdGhpcy5jdXJXZWJGcmFtZXMgPSBbXTtcbiAgfSk7XG59O1xuXG5leHRlbnNpb25zLmxpc3RXZWJGcmFtZXMgPSBhc3luYyBmdW5jdGlvbiBsaXN0V2ViRnJhbWVzICh1c2VVcmwgPSB0cnVlKSB7XG4gIGlmICghdGhpcy5vcHRzLmJ1bmRsZUlkKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ0Nhbm5vdCBlbnRlciB3ZWIgZnJhbWUgd2l0aG91dCBhIGJ1bmRsZSBJRCcpO1xuICB9XG5cbiAgdXNlVXJsID0gdXNlVXJsICYmICF0aGlzLmlzUmVhbERldmljZSgpICYmICEhdGhpcy5nZXRDdXJyZW50VXJsKCk7XG4gIGxvZy5kZWJ1ZyhgU2VsZWN0aW5nIGJ5IHVybDogJHt1c2VVcmx9ICR7dXNlVXJsID8gYChleHBlY3RlZCB1cmw6ICcke3RoaXMuZ2V0Q3VycmVudFVybCgpfScpYCA6ICcnfWApO1xuXG4gIGNvbnN0IGN1cnJlbnRVcmwgPSB1c2VVcmwgPyB0aGlzLmdldEN1cnJlbnRVcmwoKSA6IHVuZGVmaW5lZDtcbiAgbGV0IHBhZ2VBcnJheSA9IFtdO1xuICBjb25zdCBnZXRXZWJ2aWV3UGFnZXMgPSBhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnJlbW90ZS5zZWxlY3RBcHAoY3VycmVudFVybCwgdGhpcy5vcHRzLndlYnZpZXdDb25uZWN0UmV0cmllcywgdGhpcy5vcHRzLmlnbm9yZUFib3V0QmxhbmtVcmwpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLmRlYnVnKGBObyBhdmFpbGFibGUgd2ViIHBhZ2VzOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfTtcblxuICBpZiAodGhpcy5yZW1vdGUgJiYgdGhpcy5yZW1vdGUuYXBwSWRLZXkpIHtcbiAgICAvLyBhbHJlYWR5IGNvbm5lY3RlZFxuICAgIHBhZ2VBcnJheSA9IGF3YWl0IGdldFdlYnZpZXdQYWdlcygpO1xuICB9IGVsc2Uge1xuICAgIGlmICh0aGlzLnJlbW90ZSkge1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuc2V0Q29ubmVjdGlvbktleSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbm5lY3RUb1JlbW90ZURlYnVnZ2VyKCk7XG4gICAgfVxuXG4gICAgcGFnZUFycmF5ID0gYXdhaXQgZ2V0V2Vidmlld1BhZ2VzKCk7XG5cbiAgICBjb25zdCBhbGVydEVycm9yTXNnID0gJ0Nsb3NlIGFsZXJ0IGZhaWxlZC4gUmV0cnkuJztcbiAgICB0cnkge1xuICAgICAgYXdhaXQgcmV0cnlJbnRlcnZhbCg2LCAxMDAwLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmICghYXdhaXQgdGhpcy5jbG9zZUFsZXJ0QmVmb3JlVGVzdCgpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGFsZXJ0RXJyb3JNc2cpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIGlmIHRoZSBsb29wIHRvIGNsb3NlIGFsZXJ0cyBmYWlsZWQgdG8gZGlzbWlzcywgaWdub3JlLFxuICAgICAgLy8gb3RoZXJ3aXNlIGxvZyBhbmQgdGhyb3cgdGhlIGVycm9yXG4gICAgICBpZiAoZXJyLm1lc3NhZ2UgIT09IGFsZXJ0RXJyb3JNc2cpIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coZXJyKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAocGFnZUFycmF5Lmxlbmd0aCA9PT0gMCkge1xuICAgIC8vIHdlIGhhdmUgbm8gd2ViIGZyYW1lcywgYnV0IGNvbnRpbnVlIGFueXdheVxuICAgIGxvZy5kZWJ1ZygnTm8gd2ViIGZyYW1lcyBmb3VuZC4nKTtcbiAgfVxuICByZXR1cm4gcGFnZUFycmF5O1xufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBDb250ZXh0XG4gKlxuICogQHByb3BlcnR5IHtzdHJpbmd9IGlkIC0gVGhlIGlkZW50aWZpZXIgb2YgdGhlIGNvbnRleHQuIFRoZSBuYXRpdmUgY29udGV4dFxuICogICAgICAgICAgICAgICAgICAgICAgICAgIHdpbGwgYmUgJ05BVElWRV9BUFAnIGFuZCB0aGUgd2Vidmlld3Mgd2lsbCBiZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICdXRUJWSUVXX3h4eCdcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gdGl0bGUgLSBUaGUgdGl0bGUgYXNzb2NpYXRlZCB3aXRoIHRoZSB3ZWJ2aWV3IGNvbnRlbnRcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gdXJsIC0gVGhlIHVybCBhc3NvY2lhdGVkIHdpdGggdGhlIHdlYnZpZXcgY29udGVudFxuICovXG5cbi8qKlxuICogR2V0IHRoZSBjb250ZXh0cyBhdmFpbGFibGUsIHdpdGggaW5mb3JtYXRpb24gYWJvdXQgdGhlIHVybCBhbmQgdGl0bGUgb2YgZWFjaFxuICogd2Vidmlld1xuICogQHJldHVybnMge0FycmF5fSBMaXN0IG9mIENvbnRleHQgb2JqZWN0c1xuICovXG5leHRlbnNpb25zLm1vYmlsZUdldENvbnRleHRzID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlR2V0Q29udGV4dHMgKCkge1xuICBjb25zdCBjdXJPcHQgPSB0aGlzLm9wdHMuZnVsbENvbnRleHRMaXN0O1xuICB0cnkge1xuICAgIC8vIGBhcHBpdW0taW9zLWRyaXZlciNnZXRDb250ZXh0c2AgcmV0dXJucyB0aGUgZnVsbCBsaXN0IG9mIGNvbnRleHRzXG4gICAgLy8gaWYgdGhpcyBvcHRpb24gaXMgb25cbiAgICB0aGlzLm9wdHMuZnVsbENvbnRleHRMaXN0ID0gdHJ1ZTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRDb250ZXh0cygpO1xuICB9IGZpbmFsbHkge1xuICAgIC8vIHJlc2V0IHRoZSBvcHRpb24gc28gdGhlcmUgYXJlIG5vIHNpZGUgZWZmZWN0c1xuICAgIHRoaXMub3B0cy5mdWxsQ29udGV4dExpc3QgPSBjdXJPcHQ7XG4gIH1cbn07XG5cbmNvbW1hbmRzLnNldFdpbmRvdyA9IGFzeW5jIGZ1bmN0aW9uIHNldFdpbmRvdyAobmFtZSwgc2tpcFJlYWR5Q2hlY2spIHtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLnNldENvbnRleHQobmFtZSwgXy5ub29wLCBza2lwUmVhZHlDaGVjayk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIC8vIHRyYW5zbGF0ZSB0aGUgZXJyb3IgaW4gdGVybXMgb2Ygd2luZG93c1xuICAgIHRocm93IGlzRXJyb3JUeXBlKGVyciwgZXJyb3JzLk5vU3VjaENvbnRleHRFcnJvcilcbiAgICAgID8gbmV3IGVycm9ycy5Ob1N1Y2hXaW5kb3dFcnJvcigpXG4gICAgICA6IGVycjtcbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0V2luZG93SGFuZGxlID0gYXN5bmMgZnVuY3Rpb24gZ2V0V2luZG93SGFuZGxlICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9XG4gIGxvZy5kZWJ1ZyhgR2V0dGluZyBjdXJyZW50IHdpbmRvdyBoYW5kbGVgKTtcbiAgcmV0dXJuIHRoaXMuY3VyQ29udGV4dDtcbn07XG5cbmNvbW1hbmRzLmdldFdpbmRvd0hhbmRsZXMgPSBhc3luYyBmdW5jdGlvbiBnZXRXaW5kb3dIYW5kbGVzICgpIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cbiAgbG9nLmRlYnVnKCdHZXR0aW5nIGxpc3Qgb2YgYXZhaWxhYmxlIHdpbmRvdyBoYW5kbGVzJyk7XG4gIGNvbnN0IGNvbnRleHRzID0gYXdhaXQgdGhpcy5nZXRDb250ZXh0c0FuZFZpZXdzKGZhbHNlKTtcbiAgcmV0dXJuIGNvbnRleHRzXG4gICAgLy8gZ2V0IHJpZCBvZiB0aGUgbmF0aXZlIGFwcCBjb250ZXh0XG4gICAgLmZpbHRlcigoY29udGV4dCkgPT4gY29udGV4dC5pZCAhPT0gTkFUSVZFX1dJTilcbiAgICAvLyBnZXQgdGhlIGBhcHAuaWRgIGZvcm1hdCBleHBlY3RlZFxuICAgIC5tYXAoKGNvbnRleHQpID0+IGNvbnRleHQudmlldy5pZC50b1N0cmluZygpKTtcbn07XG5cbmV4dGVuc2lvbnMub25QYWdlQ2hhbmdlID0gYXN5bmMgZnVuY3Rpb24gb25QYWdlQ2hhbmdlIChwYWdlQ2hhbmdlTm90aWZpY2F0aW9uKSB7XG4gIGxvZy5kZWJ1ZyhgUmVtb3RlIGRlYnVnZ2VyIG5vdGlmaWVkIHVzIG9mIGEgbmV3IHBhZ2UgbGlzdGluZzogJHtKU09OLnN0cmluZ2lmeShwYWdlQ2hhbmdlTm90aWZpY2F0aW9uKX1gKTtcbiAgaWYgKHRoaXMuc2VsZWN0aW5nTmV3UGFnZSkge1xuICAgIGxvZy5kZWJ1ZygnV2UgYXJlIGluIHRoZSBtaWRkbGUgb2Ygc2VsZWN0aW5nIGEgcGFnZSwgaWdub3JpbmcnKTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKCF0aGlzLnJlbW90ZSB8fCAhdGhpcy5yZW1vdGUuaXNDb25uZWN0ZWQoKSkge1xuICAgIGxvZy5kZWJ1ZygnV2UgaGF2ZSBub3QgeWV0IGNvbm5lY3RlZCwgaWdub3JpbmcnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCB7YXBwSWRLZXksIHBhZ2VBcnJheX0gPSBwYWdlQ2hhbmdlTm90aWZpY2F0aW9uO1xuXG4gIGxldCBuZXdJZHMgPSBbXTtcbiAgbGV0IG5ld1BhZ2VzID0gW107XG4gIGxldCBrZXlJZCA9IG51bGw7XG4gIGZvciAoY29uc3QgcGFnZSBvZiBwYWdlQXJyYXkpIHtcbiAgICBjb25zdCBpZCA9IHBhZ2UuaWQudG9TdHJpbmcoKTtcbiAgICBuZXdJZHMucHVzaChpZCk7XG4gICAgaWYgKHBhZ2UuaXNLZXkpIHtcbiAgICAgIGtleUlkID0gaWQ7XG4gICAgfVxuICAgIGNvbnN0IGNvbnRleHRJZCA9IGAke2FwcElkS2V5fS4ke2lkfWA7XG5cbiAgICAvLyBhZGQgaWYgdGhpcyBpcyBhIG5ldyBwYWdlXG4gICAgaWYgKCFfLmluY2x1ZGVzKHRoaXMuY29udGV4dHMsIGNvbnRleHRJZCkpIHtcbiAgICAgIG5ld1BhZ2VzLnB1c2goaWQpO1xuICAgICAgdGhpcy5jb250ZXh0cy5wdXNoKGNvbnRleHRJZCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKCFrZXlJZCkge1xuICAgIC8vIGlmIHRoZXJlIGlzIG5vIGtleSBpZCwgcHVsbCB0aGUgZmlyc3QgaWQgZnJvbSB0aGUgcGFnZSBhcnJheSBhbmQgdXNlIHRoYXRcbiAgICAvLyBhcyBhIHN0YW5kIGluXG4gICAgbG9nLmRlYnVnKCdObyBrZXkgaWQgZm91bmQuIENob29zaW5nIGZpcnN0IGlkIGZyb20gcGFnZSBhcnJheScpO1xuICAgIGtleUlkID0gbmV3SWRzWzBdIHx8IG51bGw7XG4gIH1cblxuICBpZiAoIXV0aWwuaGFzVmFsdWUodGhpcy5jdXJDb250ZXh0KSkge1xuICAgIGxvZy5kZWJ1ZygnV2UgZG8gbm90IGFwcGVhciB0byBoYXZlIHdpbmRvdyBzZXQgeWV0LCBpZ25vcmluZycpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IFtjdXJBcHBJZEtleSwgY3VyUGFnZUlkS2V5XSA9IHRoaXMuY3VyQ29udGV4dC5zcGxpdCgnLicpO1xuXG4gIGlmIChjdXJBcHBJZEtleSAhPT0gYXBwSWRLZXkpIHtcbiAgICBsb2cuZGVidWcoJ1BhZ2UgY2hhbmdlIG5vdCByZWZlcnJpbmcgdG8gY3VycmVudGx5IHNlbGVjdGVkIGFwcCwgaWdub3JpbmcuJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbGV0IG5ld1BhZ2UgPSBudWxsO1xuICBpZiAobmV3UGFnZXMubGVuZ3RoKSB7XG4gICAgbmV3UGFnZSA9IF8ubGFzdChuZXdQYWdlcyk7XG4gICAgbG9nLmRlYnVnKGBXZSBoYXZlIG5ldyBwYWdlcywgc2VsZWN0aW5nIHBhZ2UgJyR7bmV3UGFnZX0nYCk7XG4gIH0gZWxzZSBpZiAoIV8uaW5jbHVkZXMobmV3SWRzLCBjdXJQYWdlSWRLZXkpKSB7XG4gICAgbG9nLmRlYnVnKCdOZXcgcGFnZSBsaXN0aW5nIGZyb20gcmVtb3RlIGRlYnVnZ2VyIGRvZXMgbm90IGNvbnRhaW4gJyArXG4gICAgICAgICAgICAgICAgICdjdXJyZW50IHdpbmRvdzsgYXNzdW1pbmcgaXQgaXMgY2xvc2VkJyk7XG4gICAgaWYgKCF1dGlsLmhhc1ZhbHVlKGtleUlkKSkge1xuICAgICAgbG9nLmVycm9yKCdEbyBub3QgaGF2ZSBvdXIgY3VycmVudCB3aW5kb3cgYW55bW9yZSwgYW5kIHRoZXJlICcgK1xuICAgICAgICAgICAgICAgICAgICdhcmUgbm90IGFueSBtb3JlIHRvIGxvYWQhIERvaW5nIG5vdGhpbmcuLi4nKTtcbiAgICAgIHRoaXMuc2V0Q3VycmVudFVybCh1bmRlZmluZWQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgRGVidWdnZXIgYWxyZWFkeSBzZWxlY3RlZCBwYWdlICcke2tleUlkfScsIGAgK1xuICAgICAgICAgICAgICAgICBgY29uZmlybWluZyB0aGF0IGNob2ljZS5gKTtcbiAgICB0aGlzLmN1ckNvbnRleHQgPSBgJHthcHBJZEtleX0uJHtrZXlJZH1gO1xuICAgIG5ld1BhZ2UgPSBrZXlJZDtcbiAgfSBlbHNlIHtcbiAgICAvLyBhdCB0aGlzIHBvaW50LCB0aGVyZSBhcmUgbm8gbmV3IHBhZ2VzLCBhbmQgdGhlIGN1cnJlbnQgcGFnZSBzdGlsbCBleGlzdHNcbiAgICBsb2cuZGVidWcoJ0NoZWNraW5nIGlmIHBhZ2UgbmVlZHMgdG8gbG9hZCcpO1xuICAgIC8vIElmIGEgd2luZG93IG5hdmlnYXRlcyB0byBhbiBhbmNob3IgaXQgZG9lc24ndCBhbHdheXMgZmlyZSBhIHBhZ2VcbiAgICAvLyBjYWxsYmFjayBldmVudC4gTGV0J3MgY2hlY2sgaWYgd2Ugd291bmQgdXAgaW4gc3VjaCBhIHNpdHVhdGlvbi5cbiAgICBjb25zdCBuZWVkc1BhZ2VMb2FkID0gKCgpID0+IHtcbiAgICAgIC8vIG5lZWQgdG8gbWFwIHRoZSBwYWdlIGlkcyB0byBjb250ZXh0IGlkc1xuICAgICAgY29uc3QgY29udGV4dEFycmF5ID0gXy5tYXAocGFnZUFycmF5LCAocGFnZSkgPT4gYCR7YXBwSWRLZXl9LiR7cGFnZS5pZH1gKTtcbiAgICAgIC8vIGNoZWNrIGlmIHRoZSBjdXJyZW50IGNvbnRleHQgZXhpc3RzIGluIGJvdGggb3VyIHJlY29yZGVkIGNvbnRleHRzLFxuICAgICAgLy8gYW5kIHRoZSBwYWdlIGFycmF5XG4gICAgICByZXR1cm4gIV8uaXNFcXVhbChfLmZpbmQodGhpcy5jb250ZXh0cywgdGhpcy5jdXJDb250ZXh0KSwgXy5maW5kKGNvbnRleHRBcnJheSwgdGhpcy5jdXJDb250ZXh0KSk7XG4gICAgfSkoKTtcblxuICAgIGlmIChuZWVkc1BhZ2VMb2FkKSB7XG4gICAgICBsb2cuZGVidWcoJ1BhZ2UgbG9hZCBuZWVkZWQuIExvYWRpbmcuLi4nKTtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLnBhZ2VMb2FkKCk7XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKCdOZXcgcGFnZSBsaXN0aW5nIGlzIHNhbWUgYXMgb2xkLCBkb2luZyBub3RoaW5nJyk7XG4gIH1cblxuICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgcGFnZSBsaXN0aW5nIGlzbid0IGluZGljYXRpbmcgYSByZWRpcmVjdFxuICBpZiAodXRpbC5oYXNWYWx1ZSh0aGlzLmN1ckNvbnRleHQpKSB7XG4gICAgbGV0IGN1cnJlbnRQYWdlSWQgPSBwYXJzZUludChfLmxhc3QodGhpcy5jdXJDb250ZXh0LnNwbGl0KCcuJykpLCAxMCk7XG4gICAgbGV0IHBhZ2UgPSBfLmZpbmQocGFnZUFycmF5LCAocCkgPT4gcGFyc2VJbnQocC5pZCwgMTApID09PSBjdXJyZW50UGFnZUlkKTtcbiAgICBpZiAocGFnZSAmJiBwYWdlLnVybCAhPT0gdGhpcy5nZXRDdXJyZW50VXJsKCkpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgUmVkaXJlY3RlZCBmcm9tICcke3RoaXMuZ2V0Q3VycmVudFVybCgpfScgdG8gJyR7cGFnZS51cmx9J2ApO1xuICAgICAgdGhpcy5zZXRDdXJyZW50VXJsKHBhZ2UudXJsKTtcbiAgICB9XG4gIH1cblxuICBpZiAodXRpbC5oYXNWYWx1ZShuZXdQYWdlKSkge1xuICAgIHRoaXMuc2VsZWN0aW5nTmV3UGFnZSA9IHRydWU7XG4gICAgY29uc3Qgb2xkQ29udGV4dCA9IHRoaXMuY3VyQ29udGV4dDtcbiAgICB0aGlzLmN1ckNvbnRleHQgPSBgJHthcHBJZEtleX0uJHtuZXdQYWdlfWA7XG4gICAgLy8gZG8gbm90IHdhaXQsIGFzIHRoaXMgY2FuIHRha2UgYSBsb25nIHRpbWUsIGFuZCB0aGUgcmVzcG9uc2UgaXMgbm90IG5lY2Vzc2FyeVxuICAgIHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UoYXBwSWRLZXksIHBhcnNlSW50KG5ld1BhZ2UsIDEwKSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tY2FsbGJhY2tzXG4gICAgICAgIGxvZy53YXJuKGBGYWlsZWQgdG8gc2VsZWN0IHBhZ2U6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICAgIHRoaXMuY3VyQ29udGV4dCA9IG9sZENvbnRleHQ7XG4gICAgICB9KTtcbiAgICB0aGlzLnNlbGVjdGluZ05ld1BhZ2UgPSBmYWxzZTtcbiAgfVxuICB0aGlzLndpbmRvd0hhbmRsZUNhY2hlID0gcGFnZUFycmF5O1xufTtcblxuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzLCBoZWxwZXJzKTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9jb250ZXh0LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
