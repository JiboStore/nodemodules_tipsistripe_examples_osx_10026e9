"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RPC_RESPONSE_TIMEOUT_MS = exports.REMOTE_DEBUGGER_PORT = exports.RemoteDebugger = void 0;

require("source-map-support/register");

var _events = _interopRequireDefault(require("events"));

var _logger = _interopRequireDefault(require("./logger"));

var _appiumBaseDriver = require("appium-base-driver");

var _rpcClientSimulator = _interopRequireDefault(require("./rpc-client-simulator"));

var _messageHandlers = _interopRequireDefault(require("./message-handlers"));

var _helpers = require("./helpers");

var _appiumSupport = require("appium-support");

var _asyncbox = require("asyncbox");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _path = _interopRequireDefault(require("path"));

var _uuidJs = _interopRequireDefault(require("uuid-js"));

var _asyncLock = _interopRequireDefault(require("async-lock"));

let VERSION;

try {
  VERSION = require(_path.default.resolve(__dirname, '..', '..', 'package.json')).version;
} catch (ign) {}

const SELECT_APP_RETRIES = 20;
const SELECT_APP_RETRY_SLEEP_MS = 500;
const REMOTE_DEBUGGER_PORT = 27753;
exports.REMOTE_DEBUGGER_PORT = REMOTE_DEBUGGER_PORT;
const SAFARI_BUNDLE_ID = 'com.apple.mobilesafari';
const BLANK_PAGE_URL = 'about:blank';
const RPC_RESPONSE_TIMEOUT_MS = 5000;
exports.RPC_RESPONSE_TIMEOUT_MS = RPC_RESPONSE_TIMEOUT_MS;
const PAGE_READY_TIMEOUT = 5000;
const GARBAGE_COLLECT_TIMEOUT = 5000;
const ACTIVE_APP_CODE = 0;

class RemoteDebugger extends _events.default.EventEmitter {
  constructor(opts = {}) {
    super();

    if (VERSION) {
      _logger.default.info(`Remote Debugger version ${VERSION}`);
    }

    const {
      bundleId,
      platformVersion,
      isSafari = true,
      includeSafari = false,
      useNewSafari = false,
      pageLoadMs,
      host,
      port = REMOTE_DEBUGGER_PORT,
      socketPath,
      pageReadyTimeout = PAGE_READY_TIMEOUT,
      remoteDebugProxy,
      garbageCollectOnExecute = false,
      logFullResponse = false,
      logAllCommunication = false,
      logAllCommunicationHexDump = false,
      socketChunkSize
    } = opts;
    this.bundleId = bundleId;
    this.platformVersion = platformVersion;
    this.isSafari = isSafari;
    this.includeSafari = includeSafari;
    this.useNewSafari = useNewSafari;
    this.pageLoadMs = pageLoadMs;

    _logger.default.debug(`useNewSafari --> ${this.useNewSafari}`);

    this.garbageCollectOnExecute = garbageCollectOnExecute;
    this.host = host;
    this.port = port;
    this.socketPath = socketPath;
    this.remoteDebugProxy = remoteDebugProxy;
    this.pageReadyTimeout = pageReadyTimeout;
    this.logAllCommunication = _lodash.default.isNil(logAllCommunication) ? !!logFullResponse : !!logAllCommunication;
    this.logAllCommunicationHexDump = logAllCommunicationHexDump;
    this.socketChunkSize = socketChunkSize;
    this.skippedApps = [];
    this._lock = new _asyncLock.default();
  }

  setup() {
    this.appDict = {};
    this.appIdKey = null;
    this.pageIdKey = null;
    this.pageLoading = false;
    this._navigatingToPage = false;
    this.allowNavigationWithoutReload = false;
    this.specialCbs = {
      '_rpc_reportIdentifier:': _lodash.default.noop,
      '_rpc_forwardGetListing:': this.onPageChange.bind(this),
      '_rpc_reportConnectedApplicationList:': this.onConnectedApplicationList.bind(this),
      '_rpc_applicationConnected:': this.onAppConnect.bind(this),
      '_rpc_applicationDisconnected:': this.onAppDisconnect.bind(this),
      '_rpc_applicationUpdated:': this.onAppUpdate.bind(this),
      '_rpc_reportConnectedDriverList:': this.onConnectedDriverList.bind(this),
      pageLoad: this.pageLoad.bind(this),
      frameDetached: this.frameDetached.bind(this)
    };
    this.rpcClient = null;
  }

  teardown() {
    _logger.default.debug('Cleaning up listeners');

    this.appDict = {};
    this.appIdKey = null;
    this.pageIdKey = null;
    this.pageLoading = false;
    this.specialCbs = {};
    this.rpcClient = null;
    this.removeAllListeners(RemoteDebugger.EVENT_PAGE_CHANGE);
    this.removeAllListeners(RemoteDebugger.EVENT_DISCONNECT);
  }

  async connect() {
    this.setup();
    this.rpcClient = new _rpcClientSimulator.default({
      bundleId: this.bundleId,
      platformVersion: this.platformVersion,
      isSafari: this.isSafari,
      host: this.host,
      port: this.port,
      socketPath: this.socketPath,
      specialMessageHandlers: this.specialCbs,
      messageProxy: this.remoteDebugProxy,
      logAllCommunication: this.logAllCommunication,
      logAllCommunicationHexDump: this.logAllCommunicationHexDump
    });
    await this.rpcClient.connect();

    try {
      await this.setConnectionKey();
      return this.appDict || {};
    } catch (err) {
      _logger.default.error(`Error setting connection key: ${err.message}`);

      await this.disconnect();
      throw err;
    }
  }

  async disconnect() {
    if (this.rpcClient) {
      await this.rpcClient.disconnect();
    }

    this.emit(RemoteDebugger.EVENT_DISCONNECT, true);
    this.teardown();
  }

  isConnected() {
    return !!(this.rpcClient && this.rpcClient.isConnected());
  }

  async setConnectionKey() {
    _logger.default.debug('Sending connection key request');

    await this.rpcClient.send('setConnectionKey', {}, false);
  }

  updateAppsWithDict(dict) {
    this.appDict = this.appDict || {};
    let [id, entry] = (0, _helpers.appInfoFromDict)(dict);

    if (this.appDict[id]) {
      entry.pageArray = this.appDict[id].pageArray;
    }

    this.appDict[id] = entry;

    if (_lodash.default.isUndefined(entry.pageArray)) {
      entry.pageArray = (0, _helpers.deferredPromise)();
    }

    if (!this.appIdKey) {
      this.appIdKey = (0, _helpers.getDebuggerAppKey)(this.bundleId, this.appDict);
    }
  }

  logApplicationDictionary(apps) {
    function getValueString(key, value) {
      if (_lodash.default.isFunction(value)) {
        return '[Function]';
      }

      if (key === 'pageArray' && !_lodash.default.isArray(value)) {
        return `'Waiting for data'`;
      }

      return JSON.stringify(value);
    }

    _logger.default.debug('Current applications available:');

    for (const [app, info] of _lodash.default.toPairs(apps)) {
      _logger.default.debug(`    Application: '${app}'`);

      for (const [key, value] of _lodash.default.toPairs(info)) {
        if (key === 'pageArray' && Array.isArray(value) && value.length) {
          _logger.default.debug(`        ${key}:`);

          for (const page of value) {
            let prefix = '- ';

            for (const [k, v] of _lodash.default.toPairs(page)) {
              _logger.default.debug(`          ${prefix}${k}: ${JSON.stringify(v)}`);

              prefix = '  ';
            }
          }
        } else {
          const valueString = getValueString(key, value);

          _logger.default.debug(`        ${key}: ${valueString}`);
        }
      }
    }
  }

  async selectApp(currentUrl = null, maxTries = SELECT_APP_RETRIES, ignoreAboutBlankUrl = false) {
    const shouldCheckForTarget = this.rpcClient.shouldCheckForTarget;
    this.rpcClient.shouldCheckForTarget = false;

    try {
      const startTime = process.hrtime();

      _logger.default.debug('Selecting application');

      if (!this.appDict || _lodash.default.isEmpty(this.appDict)) {
        _logger.default.debug('No applications currently connected.');

        return [];
      }

      const {
        appIdKey,
        pageDict
      } = await this.searchForApp(currentUrl, maxTries, ignoreAboutBlankUrl);

      if (!appIdKey || !pageDict) {
        _logger.default.errorAndThrow(`Could not connect to a valid app after ${maxTries} tries.`);
      }

      if (this.appIdKey !== appIdKey) {
        _logger.default.debug(`Received altered app id, updating from '${this.appIdKey}' to '${appIdKey}'`);

        this.appIdKey = appIdKey;
      }

      this.logApplicationDictionary(this.appDict);
      const pageArray = _lodash.default.isEmpty(this.appDict[appIdKey].pageArray) ? (0, _helpers.pageArrayFromDict)(pageDict) : this.appDict[appIdKey].pageArray;

      _logger.default.debug(`Finally selecting app ${this.appIdKey}: ${(0, _helpers.simpleStringify)(pageArray)}`);

      let fullPageArray = [];

      for (const [app, info] of _lodash.default.toPairs(this.appDict)) {
        if (!_lodash.default.isArray(info.pageArray) || info.isActive === ACTIVE_APP_CODE) {
          continue;
        }

        const id = app.replace('PID:', '');

        for (const page of info.pageArray) {
          if (page.url && (!ignoreAboutBlankUrl || page.url !== BLANK_PAGE_URL)) {
            let pageDict = _lodash.default.clone(page);

            pageDict.id = `${id}.${pageDict.id}`;
            fullPageArray.push(pageDict);
          }
        }
      }

      _logger.default.debug(`Selected app after ${(0, _helpers.getElapsedTime)(startTime)}ms`);

      return fullPageArray;
    } finally {
      this.rpcClient.shouldCheckForTarget = shouldCheckForTarget;
    }
  }

  async searchForApp(currentUrl, maxTries, ignoreAboutBlankUrl) {
    const bundleIds = this.includeSafari && !this.isSafari ? [this.bundleId, SAFARI_BUNDLE_ID] : [this.bundleId];

    try {
      return await (0, _asyncbox.retryInterval)(maxTries, SELECT_APP_RETRY_SLEEP_MS, async retryCount => {
        this.logApplicationDictionary(this.appDict);
        const possibleAppIds = (0, _helpers.getPossibleDebuggerAppKeys)(bundleIds, this.appDict);

        _logger.default.debug(`Trying out the possible app ids: ${possibleAppIds.join(', ')} (try #${retryCount + 1} of ${maxTries})`);

        for (const attemptedAppIdKey of possibleAppIds) {
          try {
            if (this.appDict[attemptedAppIdKey].isActive === ACTIVE_APP_CODE) {
              _logger.default.debug(`Skipping app '${attemptedAppIdKey}' because it is not active`);

              continue;
            }

            _logger.default.debug(`Attempting app '${attemptedAppIdKey}'`);

            const [appIdKey, pageDict] = await this.rpcClient.selectApp(attemptedAppIdKey, this.onAppConnect.bind(this));

            if (_lodash.default.isEmpty(pageDict)) {
              _logger.default.debug('Empty page dictionary received. Trying again.');

              continue;
            }

            this.appDict[appIdKey].pageArray = (0, _helpers.pageArrayFromDict)(pageDict);
            const result = this.searchForPage(this.appDict, currentUrl, ignoreAboutBlankUrl);

            if (result) {
              return result;
            }

            if (currentUrl) {
              _logger.default.debug(`Received app, but expected url ('${currentUrl}') was not found. Trying again.`);
            } else {
              _logger.default.debug('Received app, but no match was found. Trying again.');
            }
          } catch (err) {
            _logger.default.debug(`Error checking application: '${err.message}'. Retrying connection`);
          }
        }

        retryCount++;
        throw new Error('Failed to find an app to select');
      }, 0);
    } catch (ign) {
      _logger.default.errorAndThrow(`Could not connect to a valid app after ${maxTries} tries.`);
    }
  }

  searchForPage(appsDict, currentUrl = null, ignoreAboutBlankUrl = false) {
    for (const appDict of _lodash.default.values(appsDict)) {
      if (!appDict || appDict.isActive === ACTIVE_APP_CODE || !appDict.pageArray || appDict.pageArray.promise) {
        continue;
      }

      for (const dict of appDict.pageArray) {
        if ((!ignoreAboutBlankUrl || dict.url !== BLANK_PAGE_URL) && (!currentUrl || dict.url === currentUrl || dict.url === `${currentUrl}/`)) {
          return {
            appIdKey: appDict.id,
            pageDict: dict
          };
        }
      }
    }

    return null;
  }

  async selectPage(appIdKey, pageIdKey, skipReadyCheck = false) {
    this.appIdKey = `PID:${appIdKey}`;
    this.pageIdKey = pageIdKey;

    _logger.default.debug(`Selecting page '${pageIdKey}' on app '${this.appIdKey}' and forwarding socket setup`);

    const startTime = process.hrtime();
    await this.rpcClient.selectPage(this.appIdKey, pageIdKey);

    if (!skipReadyCheck && !(await this.checkPageIsReady())) {
      await this.pageUnload();
    }

    _logger.default.debug(`Selected page after ${(0, _helpers.getElapsedTime)(startTime)}ms`);
  }

  async executeAtom(atom, args, frames) {
    if (!this.rpcClient.isConnected()) {
      throw new Error('Remote debugger is not connected');
    }

    _logger.default.debug(`Executing atom '${atom}'`);

    const script = await (0, _helpers.getScriptForAtom)(atom, args, frames);
    const value = await this.execute(script, true);

    _logger.default.debug(`Received result for atom '${atom}' execution: ${_lodash.default.truncate((0, _helpers.simpleStringify)(value), {
      length: _helpers.RESPONSE_LOG_LENGTH
    })}`);

    return value;
  }

  async executeAtomAsync(atom, args, frames) {
    const promiseName = `appiumAsyncExecutePromise${_uuidJs.default.create().toString().replace(/-/g, '')}`;
    let script = `var res, rej;` + `window.${promiseName} = new Promise(function (resolve, reject) {` + `  res = resolve;` + `  rej = reject;` + `});` + `window.${promiseName}.resolve = res;` + `window.${promiseName}.reject = rej;` + `window.${promiseName};`;
    const obj = await this.rpcClient.send('sendJSCommand', {
      command: script,
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      returnByValue: false
    });
    const promiseObjectId = obj.result.objectId;
    const asyncCallBack = `function (res) {` + `  window.${promiseName}.resolve(res);` + `  window.${promiseName}Value = res;` + `}`;
    await this.execute((await (0, _helpers.getScriptForAtom)(atom, args, frames, asyncCallBack)));
    let res;
    const subcommandTimeout = 1000;

    try {
      res = await this.rpcClient.send('awaitPromise', {
        promiseObjectId,
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey
      });
    } catch (err) {
      if (!err.message.includes(`'Runtime.awaitPromise' was not found`)) {
        throw err;
      }

      const retryWait = 100;
      const timeout = args.length >= 3 ? args[2] : RPC_RESPONSE_TIMEOUT_MS;
      const retries = parseInt(timeout / retryWait, 10);
      const startTime = process.hrtime();
      res = await (0, _asyncbox.retryInterval)(retries, retryWait, async () => {
        if (await this.executeAtom('execute_script', [`return window.hasOwnProperty('${promiseName}Value');`, [null, null], subcommandTimeout], frames)) {
          return await this.executeAtom('execute_script', [`return window.${promiseName}Value;`, [null, null], subcommandTimeout], frames);
        }

        throw new _appiumBaseDriver.errors.TimeoutError(`Timed out waiting for asynchronous script ` + `result after ${(0, _helpers.getElapsedTime)(startTime)} ms'));`);
      });
    } finally {
      try {
        await this.executeAtom('execute_script', [`delete window.${promiseName};`, [null, null], subcommandTimeout], frames);
      } catch (ign) {}
    }

    return (0, _helpers.convertResult)(res);
  }

  frameDetached() {
    this.emit(RemoteDebugger.EVENT_FRAMES_DETACHED);
  }

  async pageLoad(startPageLoadMs, pageLoadVerifyHook) {
    let timeoutMs = 500;
    let start = startPageLoadMs || Date.now();

    _logger.default.debug('Page loaded, verifying whether ready');

    this.pageLoading = true;

    const verify = async () => {
      this.pageLoadDelay = _appiumSupport.util.cancellableDelay(timeoutMs);

      try {
        await this.pageLoadDelay;
      } catch (err) {
        if (err instanceof _bluebird.default.CancellationError) {
          return;
        }
      }

      if (!this.appIdKey) {
        _logger.default.debug('Not connected to an application. Ignoring page load');

        return;
      }

      if (_lodash.default.isFunction(pageLoadVerifyHook)) {
        await pageLoadVerifyHook();
      }

      const ready = await this.checkPageIsReady();

      if (ready || this.pageLoadMs > 0 && start + this.pageLoadMs < Date.now()) {
        _logger.default.debug('Page is ready');

        this.pageLoading = false;
      } else {
        _logger.default.debug('Page was not ready, retrying');

        await verify();
      }
    };

    await verify();
  }

  cancelPageLoad() {
    _logger.default.debug('Unregistering from page readiness notifications');

    this.pageLoading = false;

    if (this.pageLoadDelay) {
      this.pageLoadDelay.cancel();
    }
  }

  async pageUnload() {
    _logger.default.debug('Page unloading');

    await this.waitForDom();
  }

  async waitForDom(startPageLoadMs, pageLoadVerifyHook) {
    _logger.default.debug('Waiting for dom...');

    await this.pageLoad(startPageLoadMs, pageLoadVerifyHook);
  }

  async checkPageIsReady() {
    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey
    });
    if (errors) throw new Error(errors);

    _logger.default.debug('Checking document readyState');

    const readyCmd = 'document.readyState;';
    let readyState = 'loading';

    try {
      readyState = await _bluebird.default.resolve(this.execute(readyCmd, true)).timeout(this.pageReadyTimeout);
    } catch (err) {
      if (!(err instanceof _bluebird.default.TimeoutError)) {
        throw err;
      }

      _logger.default.debug(`Page readiness check timed out after ${this.pageReadyTimeout}ms`);

      return false;
    }

    _logger.default.debug(`Document readyState is '${readyState}'`);

    return readyState === 'complete';
  }

  async launchSafari() {
    await this.rpcClient.send('launchApplication', {
      bundleId: SAFARI_BUNDLE_ID
    });
  }

  async navToUrl(url, pageLoadVerifyHook) {
    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    if (errors) {
      throw new Error(errors);
    }

    this._navigatingToPage = true;

    try {
      _logger.default.debug(`Navigating to new URL: '${url}'`);

      const waitForFramePromise = this.waitForFrameNavigated();
      await this.rpcClient.send('setUrl', {
        url,
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey
      });

      if (!this.useNewSafari) {
        await _bluebird.default.delay(1000);
      }

      await waitForFramePromise;
      await this.waitForDom(Date.now(), pageLoadVerifyHook);
      await this.rpcClient.send('enableConsole', {
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey
      });
    } finally {
      this._navigatingToPage = false;
    }
  }

  async waitForFrameNavigated() {
    return await new _bluebird.default(async (resolve, reject) => {
      _logger.default.debug('Waiting for frame navigated message...');

      let startMs = Date.now();

      const navEventListener = value => {
        _logger.default.debug(`Frame navigated in ${(Date.now() - startMs) / 1000}s from: ${value}`);

        if (!this.allowNavigationWithoutReload && !this.pageLoading) {
          resolve(value);
        } else {
          _logger.default.debug('Frame navigated but we were warned about it, not ' + 'considering page state unloaded');

          this.allowNavigationWithoutReload = false;
        }

        if (this.navigationDelay) {
          this.navigationDelay.cancel();
        }
      };

      this.rpcClient.setSpecialMessageHandler('Page.frameNavigated', reject, navEventListener);

      if (!this.useNewSafari || this.pageLoadMs >= 0) {
        let timeout = this.useNewSafari ? this.pageLoadMs : 500;
        this.navigationDelay = _appiumSupport.util.cancellableDelay(timeout);

        try {
          await this.navigationDelay;
          navEventListener('timeout');
        } catch (err) {}
      }
    });
  }

  async startTimeline(fn) {
    _logger.default.debug('Starting to record the timeline');

    this.rpcClient.setTimelineEventHandler(fn);
    return await this.rpcClient.send('startTimeline', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async stopTimeline() {
    _logger.default.debug('Stopping to record the timeline');

    await this.rpcClient.send('stopTimeline', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async startConsole(fn) {
    _logger.default.debug('Starting to listen for JavaScript console');

    if (_lodash.default.isFunction(fn)) {
      this.rpcClient.setConsoleLogEventHandler(fn);
    }
  }

  async stopConsole() {
    _logger.default.debug('Stopping to listen for JavaScript console');

    await this.rpcClient.send('disableConsole', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async startNetwork(fn) {
    _logger.default.debug('Starting to listen for network events');

    this.rpcClient.setNetworkLogEventHandler(fn);
    return await this.rpcClient.send('startNetwork', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async stopNetwork() {
    _logger.default.debug('Stopping to listen for network events');

    await this.rpcClient.send('stopNetwork', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async execute(command, override) {
    if (this.pageLoading && !override) {
      _logger.default.debug('Trying to execute but page is not loaded.');

      await this.waitForDom();
    }

    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    if (errors) {
      throw new Error(errors);
    }

    if (this.garbageCollectOnExecute) {
      await this.garbageCollect();
    }

    _logger.default.debug(`Sending javascript command: '${_lodash.default.truncate(command, {
      length: 50
    })}'`);

    let res = await this.rpcClient.send('sendJSCommand', {
      command,
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
    return (0, _helpers.convertResult)(res);
  }

  async callFunction(objId, fn, args) {
    let errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
    if (errors) throw new Error(errors);

    if (this.garbageCollectOnExecute) {
      await this.garbageCollect();
    }

    _logger.default.debug('Calling javascript function');

    const res = await this.rpcClient.send('callJSFunction', {
      objId,
      fn,
      args,
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
    return (0, _helpers.convertResult)(res);
  }

  set allowNavigationWithoutReload(allow) {
    this._allowNavigationWithoutReload = allow;
  }

  get allowNavigationWithoutReload() {
    return this._allowNavigationWithoutReload;
  }

  async getCookies(urls) {
    _logger.default.debug('Getting network cookies');

    return await this.rpcClient.send('getCookies', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      urls
    });
  }

  async deleteCookie(cookieName, url) {
    _logger.default.debug(`Deleting cookie '${cookieName}' on '${url}'`);

    return await this.rpcClient.send('deleteCookie', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      cookieName,
      url
    });
  }

  async garbageCollect(timeoutMs = GARBAGE_COLLECT_TIMEOUT) {
    _logger.default.debug(`Garbage collecting with ${timeoutMs}ms timeout`);

    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    if (errors) {
      _logger.default.debug(`Unable to collect garbage at this time`);

      return;
    }

    await _bluebird.default.resolve(this.rpcClient.send('garbageCollect', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    })).timeout(timeoutMs).then(function gcSuccess() {
      _logger.default.debug(`Garbage collection successful`);
    }).catch(function gcError(err) {
      if (err instanceof _bluebird.default.TimeoutError) {
        _logger.default.debug(`Garbage collection timed out after ${timeoutMs}ms`);
      } else {
        _logger.default.debug(`Unable to collect garbage: ${err.message}`);
      }
    });
  }

  async useAppDictLock(fn) {
    return await this._lock.acquire('appDict', fn);
  }

}

exports.RemoteDebugger = RemoteDebugger;
RemoteDebugger.EVENT_PAGE_CHANGE = 'remote_debugger_page_change';
RemoteDebugger.EVENT_FRAMES_DETACHED = 'remote_debugger_frames_detached';
RemoteDebugger.EVENT_DISCONNECT = 'remote_debugger_disconnect';

for (const [name, handler] of _lodash.default.toPairs(_messageHandlers.default)) {
  RemoteDebugger.prototype[name] = handler;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9yZW1vdGUtZGVidWdnZXIuanMiXSwibmFtZXMiOlsiVkVSU0lPTiIsInJlcXVpcmUiLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsInZlcnNpb24iLCJpZ24iLCJTRUxFQ1RfQVBQX1JFVFJJRVMiLCJTRUxFQ1RfQVBQX1JFVFJZX1NMRUVQX01TIiwiUkVNT1RFX0RFQlVHR0VSX1BPUlQiLCJTQUZBUklfQlVORExFX0lEIiwiQkxBTktfUEFHRV9VUkwiLCJSUENfUkVTUE9OU0VfVElNRU9VVF9NUyIsIlBBR0VfUkVBRFlfVElNRU9VVCIsIkdBUkJBR0VfQ09MTEVDVF9USU1FT1VUIiwiQUNUSVZFX0FQUF9DT0RFIiwiUmVtb3RlRGVidWdnZXIiLCJldmVudHMiLCJFdmVudEVtaXR0ZXIiLCJjb25zdHJ1Y3RvciIsIm9wdHMiLCJsb2ciLCJpbmZvIiwiYnVuZGxlSWQiLCJwbGF0Zm9ybVZlcnNpb24iLCJpc1NhZmFyaSIsImluY2x1ZGVTYWZhcmkiLCJ1c2VOZXdTYWZhcmkiLCJwYWdlTG9hZE1zIiwiaG9zdCIsInBvcnQiLCJzb2NrZXRQYXRoIiwicGFnZVJlYWR5VGltZW91dCIsInJlbW90ZURlYnVnUHJveHkiLCJnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSIsImxvZ0Z1bGxSZXNwb25zZSIsImxvZ0FsbENvbW11bmljYXRpb24iLCJsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcCIsInNvY2tldENodW5rU2l6ZSIsImRlYnVnIiwiXyIsImlzTmlsIiwic2tpcHBlZEFwcHMiLCJfbG9jayIsIkFzeW5jTG9jayIsInNldHVwIiwiYXBwRGljdCIsImFwcElkS2V5IiwicGFnZUlkS2V5IiwicGFnZUxvYWRpbmciLCJfbmF2aWdhdGluZ1RvUGFnZSIsImFsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQiLCJzcGVjaWFsQ2JzIiwibm9vcCIsIm9uUGFnZUNoYW5nZSIsImJpbmQiLCJvbkNvbm5lY3RlZEFwcGxpY2F0aW9uTGlzdCIsIm9uQXBwQ29ubmVjdCIsIm9uQXBwRGlzY29ubmVjdCIsIm9uQXBwVXBkYXRlIiwib25Db25uZWN0ZWREcml2ZXJMaXN0IiwicGFnZUxvYWQiLCJmcmFtZURldGFjaGVkIiwicnBjQ2xpZW50IiwidGVhcmRvd24iLCJyZW1vdmVBbGxMaXN0ZW5lcnMiLCJFVkVOVF9QQUdFX0NIQU5HRSIsIkVWRU5UX0RJU0NPTk5FQ1QiLCJjb25uZWN0IiwiUnBjQ2xpZW50U2ltdWxhdG9yIiwic3BlY2lhbE1lc3NhZ2VIYW5kbGVycyIsIm1lc3NhZ2VQcm94eSIsInNldENvbm5lY3Rpb25LZXkiLCJlcnIiLCJlcnJvciIsIm1lc3NhZ2UiLCJkaXNjb25uZWN0IiwiZW1pdCIsImlzQ29ubmVjdGVkIiwic2VuZCIsInVwZGF0ZUFwcHNXaXRoRGljdCIsImRpY3QiLCJpZCIsImVudHJ5IiwicGFnZUFycmF5IiwiaXNVbmRlZmluZWQiLCJsb2dBcHBsaWNhdGlvbkRpY3Rpb25hcnkiLCJhcHBzIiwiZ2V0VmFsdWVTdHJpbmciLCJrZXkiLCJ2YWx1ZSIsImlzRnVuY3Rpb24iLCJpc0FycmF5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFwcCIsInRvUGFpcnMiLCJBcnJheSIsImxlbmd0aCIsInBhZ2UiLCJwcmVmaXgiLCJrIiwidiIsInZhbHVlU3RyaW5nIiwic2VsZWN0QXBwIiwiY3VycmVudFVybCIsIm1heFRyaWVzIiwiaWdub3JlQWJvdXRCbGFua1VybCIsInNob3VsZENoZWNrRm9yVGFyZ2V0Iiwic3RhcnRUaW1lIiwicHJvY2VzcyIsImhydGltZSIsImlzRW1wdHkiLCJwYWdlRGljdCIsInNlYXJjaEZvckFwcCIsImVycm9yQW5kVGhyb3ciLCJmdWxsUGFnZUFycmF5IiwiaXNBY3RpdmUiLCJyZXBsYWNlIiwidXJsIiwiY2xvbmUiLCJwdXNoIiwiYnVuZGxlSWRzIiwicmV0cnlDb3VudCIsInBvc3NpYmxlQXBwSWRzIiwiam9pbiIsImF0dGVtcHRlZEFwcElkS2V5IiwicmVzdWx0Iiwic2VhcmNoRm9yUGFnZSIsIkVycm9yIiwiYXBwc0RpY3QiLCJ2YWx1ZXMiLCJwcm9taXNlIiwic2VsZWN0UGFnZSIsInNraXBSZWFkeUNoZWNrIiwiY2hlY2tQYWdlSXNSZWFkeSIsInBhZ2VVbmxvYWQiLCJleGVjdXRlQXRvbSIsImF0b20iLCJhcmdzIiwiZnJhbWVzIiwic2NyaXB0IiwiZXhlY3V0ZSIsInRydW5jYXRlIiwiUkVTUE9OU0VfTE9HX0xFTkdUSCIsImV4ZWN1dGVBdG9tQXN5bmMiLCJwcm9taXNlTmFtZSIsIlVVSUQiLCJjcmVhdGUiLCJ0b1N0cmluZyIsIm9iaiIsImNvbW1hbmQiLCJyZXR1cm5CeVZhbHVlIiwicHJvbWlzZU9iamVjdElkIiwib2JqZWN0SWQiLCJhc3luY0NhbGxCYWNrIiwicmVzIiwic3ViY29tbWFuZFRpbWVvdXQiLCJpbmNsdWRlcyIsInJldHJ5V2FpdCIsInRpbWVvdXQiLCJyZXRyaWVzIiwicGFyc2VJbnQiLCJlcnJvcnMiLCJUaW1lb3V0RXJyb3IiLCJFVkVOVF9GUkFNRVNfREVUQUNIRUQiLCJzdGFydFBhZ2VMb2FkTXMiLCJwYWdlTG9hZFZlcmlmeUhvb2siLCJ0aW1lb3V0TXMiLCJzdGFydCIsIkRhdGUiLCJub3ciLCJ2ZXJpZnkiLCJwYWdlTG9hZERlbGF5IiwidXRpbCIsImNhbmNlbGxhYmxlRGVsYXkiLCJCIiwiQ2FuY2VsbGF0aW9uRXJyb3IiLCJyZWFkeSIsImNhbmNlbFBhZ2VMb2FkIiwiY2FuY2VsIiwid2FpdEZvckRvbSIsInJlYWR5Q21kIiwicmVhZHlTdGF0ZSIsImxhdW5jaFNhZmFyaSIsIm5hdlRvVXJsIiwid2FpdEZvckZyYW1lUHJvbWlzZSIsIndhaXRGb3JGcmFtZU5hdmlnYXRlZCIsImRlbGF5IiwicmVqZWN0Iiwic3RhcnRNcyIsIm5hdkV2ZW50TGlzdGVuZXIiLCJuYXZpZ2F0aW9uRGVsYXkiLCJzZXRTcGVjaWFsTWVzc2FnZUhhbmRsZXIiLCJzdGFydFRpbWVsaW5lIiwiZm4iLCJzZXRUaW1lbGluZUV2ZW50SGFuZGxlciIsInN0b3BUaW1lbGluZSIsInN0YXJ0Q29uc29sZSIsInNldENvbnNvbGVMb2dFdmVudEhhbmRsZXIiLCJzdG9wQ29uc29sZSIsInN0YXJ0TmV0d29yayIsInNldE5ldHdvcmtMb2dFdmVudEhhbmRsZXIiLCJzdG9wTmV0d29yayIsIm92ZXJyaWRlIiwiZ2FyYmFnZUNvbGxlY3QiLCJjYWxsRnVuY3Rpb24iLCJvYmpJZCIsImFsbG93IiwiX2FsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQiLCJnZXRDb29raWVzIiwidXJscyIsImRlbGV0ZUNvb2tpZSIsImNvb2tpZU5hbWUiLCJ0aGVuIiwiZ2NTdWNjZXNzIiwiY2F0Y2giLCJnY0Vycm9yIiwidXNlQXBwRGljdExvY2siLCJhY3F1aXJlIiwibmFtZSIsImhhbmRsZXIiLCJtZXNzYWdlSGFuZGxlcnMiLCJwcm90b3R5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBSUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsSUFBSUEsT0FBSjs7QUFDQSxJQUFJO0FBQ0ZBLEVBQUFBLE9BQU8sR0FBR0MsT0FBTyxDQUFDQyxjQUFLQyxPQUFMLENBQWFDLFNBQWIsRUFBd0IsSUFBeEIsRUFBOEIsSUFBOUIsRUFBb0MsY0FBcEMsQ0FBRCxDQUFQLENBQTZEQyxPQUF2RTtBQUNELENBRkQsQ0FFRSxPQUFPQyxHQUFQLEVBQVksQ0FBRTs7QUFFaEIsTUFBTUMsa0JBQWtCLEdBQUcsRUFBM0I7QUFDQSxNQUFNQyx5QkFBeUIsR0FBRyxHQUFsQztBQUNBLE1BQU1DLG9CQUFvQixHQUFHLEtBQTdCOztBQUNBLE1BQU1DLGdCQUFnQixHQUFHLHdCQUF6QjtBQUNBLE1BQU1DLGNBQWMsR0FBRyxhQUF2QjtBQUdBLE1BQU1DLHVCQUF1QixHQUFHLElBQWhDOztBQUVBLE1BQU1DLGtCQUFrQixHQUFHLElBQTNCO0FBRUEsTUFBTUMsdUJBQXVCLEdBQUcsSUFBaEM7QUFFQSxNQUFNQyxlQUFlLEdBQUcsQ0FBeEI7O0FBRUEsTUFB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QUFJa0IsS0FBSixDQUFXLHNDQUFxQ2lJLFNBQVUsSUFBMUQ7QUFDRCxPQUZELE1BRU87QUFDTG5KLHdCQUFJa0IsS0FBSixDQUFXLDhCQUE2QmtDLEdBQUcsQ0FBQ0UsT0FBUSxFQUFwRDtBQUNEO0FBQ0YsS0FaSyxDQUFOO0FBYUQ7O0FBRUQsUUFBTStJLGNBQU4sQ0FBc0J2QixFQUF0QixFQUEwQjtBQUN4QixXQUFPLE1BQU0sS0FBS3hKLEtBQUwsQ0FBV2dMLE9BQVgsQ0FBbUIsU0FBbkIsRUFBOEJ4QixFQUE5QixDQUFiO0FBQ0Q7O0FBM3VCOEM7OztBQSt1QmpEbkwsY0FBYyxDQUFDa0QsaUJBQWYsR0FBbUMsNkJBQW5DO0FBQ0FsRCxjQUFjLENBQUNxSixxQkFBZixHQUF1QyxpQ0FBdkM7QUFDQXJKLGNBQWMsQ0FBQ21ELGdCQUFmLEdBQWtDLDRCQUFsQzs7QUFHQSxLQUFLLE1BQU0sQ0FBQ3lKLElBQUQsRUFBT0MsT0FBUCxDQUFYLElBQThCckwsZ0JBQUV3RCxPQUFGLENBQVU4SCx3QkFBVixDQUE5QixFQUEwRDtBQUN4RDlNLEVBQUFBLGNBQWMsQ0FBQytNLFNBQWYsQ0FBeUJILElBQXpCLElBQWlDQyxPQUFqQztBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV2ZW50cyBmcm9tICdldmVudHMnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBlcnJvcnMgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuaW1wb3J0IFJwY0NsaWVudFNpbXVsYXRvciBmcm9tICcuL3JwYy1jbGllbnQtc2ltdWxhdG9yJztcbmltcG9ydCBtZXNzYWdlSGFuZGxlcnMgZnJvbSAnLi9tZXNzYWdlLWhhbmRsZXJzJztcbmltcG9ydCB7IGFwcEluZm9Gcm9tRGljdCwgcGFnZUFycmF5RnJvbURpY3QsIGdldERlYnVnZ2VyQXBwS2V5LFxuICAgICAgICAgZ2V0UG9zc2libGVEZWJ1Z2dlckFwcEtleXMsIGNoZWNrUGFyYW1zLCBnZXRTY3JpcHRGb3JBdG9tLFxuICAgICAgICAgc2ltcGxlU3RyaW5naWZ5LCBkZWZlcnJlZFByb21pc2UsIGdldEVsYXBzZWRUaW1lLCBjb252ZXJ0UmVzdWx0LFxuICAgICAgICAgUkVTUE9OU0VfTE9HX0xFTkdUSCB9IGZyb20gJy4vaGVscGVycyc7XG5pbXBvcnQgeyB1dGlsIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgcmV0cnlJbnRlcnZhbCB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBVVUlEIGZyb20gJ3V1aWQtanMnO1xuaW1wb3J0IEFzeW5jTG9jayBmcm9tICdhc3luYy1sb2NrJztcblxuXG5sZXQgVkVSU0lPTjtcbnRyeSB7XG4gIFZFUlNJT04gPSByZXF1aXJlKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLicsICcuLicsICdwYWNrYWdlLmpzb24nKSkudmVyc2lvbjtcbn0gY2F0Y2ggKGlnbikge31cblxuY29uc3QgU0VMRUNUX0FQUF9SRVRSSUVTID0gMjA7XG5jb25zdCBTRUxFQ1RfQVBQX1JFVFJZX1NMRUVQX01TID0gNTAwO1xuY29uc3QgUkVNT1RFX0RFQlVHR0VSX1BPUlQgPSAyNzc1MztcbmNvbnN0IFNBRkFSSV9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLm1vYmlsZXNhZmFyaSc7XG5jb25zdCBCTEFOS19QQUdFX1VSTCA9ICdhYm91dDpibGFuayc7XG5cbi8qIEhvdyBtYW55IG1pbGxpc2Vjb25kcyB0byB3YWl0IGZvciB3ZWJraXQgdG8gcmV0dXJuIGEgcmVzcG9uc2UgYmVmb3JlIHRpbWluZyBvdXQgKi9cbmNvbnN0IFJQQ19SRVNQT05TRV9USU1FT1VUX01TID0gNTAwMDtcblxuY29uc3QgUEFHRV9SRUFEWV9USU1FT1VUID0gNTAwMDtcblxuY29uc3QgR0FSQkFHRV9DT0xMRUNUX1RJTUVPVVQgPSA1MDAwO1xuXG5jb25zdCBBQ1RJVkVfQVBQX0NPREUgPSAwO1xuXG5jbGFzcyBSZW1vdGVEZWJ1Z2dlciBleHRlbmRzIGV2ZW50cy5FdmVudEVtaXR0ZXIge1xuICAvKlxuICAgKiBUaGUgY29uc3RydWN0b3IgdGFrZXMgYW4gb3B0cyBoYXNoIHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuICAgKiAgIC0gYnVuZGxlSWQgLSBpZCBvZiB0aGUgYXBwIGJlaW5nIGNvbm5lY3RlZCB0b1xuICAgKiAgIC0gcGxhdGZvcm1WZXJzaW9uIC0gdmVyc2lvbiBvZiBpT1NcbiAgICogICAtIHVzZU5ld1NhZmFyaSAtIGZvciB3ZWIgaW5zcGVjdG9yLCB3aGV0aGVyIHRoaXMgaXMgYSBuZXcgU2FmYXJpIGluc3RhbmNlXG4gICAqICAgLSBwYWdlTG9hZE1zIC0gdGhlIHRpbWUsIGluIG1zLCB0aGF0IHNob3VsZCBiZSB3YWl0ZWQgZm9yIHBhZ2UgbG9hZGluZ1xuICAgKiAgIC0gaG9zdCAtIHRoZSByZW1vdGUgZGVidWdnZXIncyBob3N0IGFkZHJlc3NcbiAgICogICAtIHBvcnQgLSB0aGUgcmVtb3RlIGRlYnVnZ2VyIHBvcnQgdGhyb3VnaCB3aGljaCB0byBjb21tdW5pY2F0ZVxuICAgKiAgIC0gbG9nQWxsQ29tbXVuaWNhdGlvbiAtIGxvZyBwbGlzdHMgc2VudCBhbmQgcmVjZWl2ZWQgZnJvbSBXZWIgSW5zcGVjdG9yXG4gICAqICAgLSBsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcCAtIGxvZyBjb21tdW5pY2F0aW9uIGZyb20gV2ViIEluc3BlY3RvciBhcyBoZXggZHVtcFxuICAgKiAgIC0gc29ja2V0Q2h1bmtTaXplIC0gc2l6ZSwgaW4gYnl0ZXMsIG9mIGNodW5rcyBvZiBkYXRhIHNlbnQgdG8gV2ViIEluc3BlY3RvciAocmVhbCBkZXZpY2Ugb25seSlcbiAgICovXG4gIGNvbnN0cnVjdG9yIChvcHRzID0ge30pIHtcbiAgICBzdXBlcigpO1xuXG4gICAgaWYgKFZFUlNJT04pIHtcbiAgICAgIGxvZy5pbmZvKGBSZW1vdGUgRGVidWdnZXIgdmVyc2lvbiAke1ZFUlNJT059YCk7XG4gICAgfVxuXG4gICAgY29uc3Qge1xuICAgICAgYnVuZGxlSWQsXG4gICAgICBwbGF0Zm9ybVZlcnNpb24sXG4gICAgICBpc1NhZmFyaSA9IHRydWUsXG4gICAgICBpbmNsdWRlU2FmYXJpID0gZmFsc2UsXG4gICAgICB1c2VOZXdTYWZhcmkgPSBmYWxzZSxcbiAgICAgIHBhZ2VMb2FkTXMsXG4gICAgICBob3N0LFxuICAgICAgcG9ydCA9IFJFTU9URV9ERUJVR0dFUl9QT1JULFxuICAgICAgc29ja2V0UGF0aCxcbiAgICAgIHBhZ2VSZWFkeVRpbWVvdXQgPSBQQUdFX1JFQURZX1RJTUVPVVQsXG4gICAgICByZW1vdGVEZWJ1Z1Byb3h5LFxuICAgICAgZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUgPSBmYWxzZSxcbiAgICAgIGxvZ0Z1bGxSZXNwb25zZSA9IGZhbHNlLFxuICAgICAgbG9nQWxsQ29tbXVuaWNhdGlvbiA9IGZhbHNlLFxuICAgICAgbG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXAgPSBmYWxzZSxcbiAgICAgIHNvY2tldENodW5rU2l6ZSxcbiAgICB9ID0gb3B0cztcblxuICAgIHRoaXMuYnVuZGxlSWQgPSBidW5kbGVJZDtcbiAgICB0aGlzLnBsYXRmb3JtVmVyc2lvbiA9IHBsYXRmb3JtVmVyc2lvbjtcbiAgICB0aGlzLmlzU2FmYXJpID0gaXNTYWZhcmk7XG4gICAgdGhpcy5pbmNsdWRlU2FmYXJpID0gaW5jbHVkZVNhZmFyaTtcbiAgICB0aGlzLnVzZU5ld1NhZmFyaSA9IHVzZU5ld1NhZmFyaTtcbiAgICB0aGlzLnBhZ2VMb2FkTXMgPSBwYWdlTG9hZE1zO1xuICAgIGxvZy5kZWJ1ZyhgdXNlTmV3U2FmYXJpIC0tPiAke3RoaXMudXNlTmV3U2FmYXJpfWApO1xuXG4gICAgdGhpcy5nYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSA9IGdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlO1xuXG4gICAgdGhpcy5ob3N0ID0gaG9zdDtcbiAgICB0aGlzLnBvcnQgPSBwb3J0O1xuICAgIHRoaXMuc29ja2V0UGF0aCA9IHNvY2tldFBhdGg7XG4gICAgdGhpcy5yZW1vdGVEZWJ1Z1Byb3h5ID0gcmVtb3RlRGVidWdQcm94eTtcbiAgICB0aGlzLnBhZ2VSZWFkeVRpbWVvdXQgPSBwYWdlUmVhZHlUaW1lb3V0O1xuXG4gICAgdGhpcy5sb2dBbGxDb21tdW5pY2F0aW9uID0gXy5pc05pbChsb2dBbGxDb21tdW5pY2F0aW9uKSA/ICEhbG9nRnVsbFJlc3BvbnNlIDogISFsb2dBbGxDb21tdW5pY2F0aW9uO1xuICAgIHRoaXMubG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXAgPSBsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcDtcbiAgICB0aGlzLnNvY2tldENodW5rU2l6ZSA9IHNvY2tldENodW5rU2l6ZTtcblxuICAgIHRoaXMuc2tpcHBlZEFwcHMgPSBbXTtcblxuICAgIHRoaXMuX2xvY2sgPSBuZXcgQXN5bmNMb2NrKCk7XG4gIH1cblxuICBzZXR1cCAoKSB7XG4gICAgLy8gYXBwIGhhbmRsaW5nIGNvbmZpZ3VyYXRpb25cbiAgICB0aGlzLmFwcERpY3QgPSB7fTtcbiAgICB0aGlzLmFwcElkS2V5ID0gbnVsbDtcbiAgICB0aGlzLnBhZ2VJZEtleSA9IG51bGw7XG4gICAgdGhpcy5wYWdlTG9hZGluZyA9IGZhbHNlO1xuICAgIHRoaXMuX25hdmlnYXRpbmdUb1BhZ2UgPSBmYWxzZTtcbiAgICB0aGlzLmFsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQgPSBmYWxzZTtcblxuICAgIC8vIHNldCB1cCB0aGUgc3BlY2lhbCBjYWxsYmFja3MgZm9yIGhhbmRsaW5nIHJkIGV2ZW50c1xuICAgIHRoaXMuc3BlY2lhbENicyA9IHtcbiAgICAgICdfcnBjX3JlcG9ydElkZW50aWZpZXI6JzogXy5ub29wLFxuICAgICAgJ19ycGNfZm9yd2FyZEdldExpc3Rpbmc6JzogdGhpcy5vblBhZ2VDaGFuZ2UuYmluZCh0aGlzKSxcbiAgICAgICdfcnBjX3JlcG9ydENvbm5lY3RlZEFwcGxpY2F0aW9uTGlzdDonOiB0aGlzLm9uQ29ubmVjdGVkQXBwbGljYXRpb25MaXN0LmJpbmQodGhpcyksXG4gICAgICAnX3JwY19hcHBsaWNhdGlvbkNvbm5lY3RlZDonOiB0aGlzLm9uQXBwQ29ubmVjdC5iaW5kKHRoaXMpLFxuICAgICAgJ19ycGNfYXBwbGljYXRpb25EaXNjb25uZWN0ZWQ6JzogdGhpcy5vbkFwcERpc2Nvbm5lY3QuYmluZCh0aGlzKSxcbiAgICAgICdfcnBjX2FwcGxpY2F0aW9uVXBkYXRlZDonOiB0aGlzLm9uQXBwVXBkYXRlLmJpbmQodGhpcyksXG4gICAgICAnX3JwY19yZXBvcnRDb25uZWN0ZWREcml2ZXJMaXN0Oic6IHRoaXMub25Db25uZWN0ZWREcml2ZXJMaXN0LmJpbmQodGhpcyksXG4gICAgICBwYWdlTG9hZDogdGhpcy5wYWdlTG9hZC5iaW5kKHRoaXMpLFxuICAgICAgZnJhbWVEZXRhY2hlZDogdGhpcy5mcmFtZURldGFjaGVkLmJpbmQodGhpcyksXG4gICAgfTtcblxuICAgIHRoaXMucnBjQ2xpZW50ID0gbnVsbDtcbiAgfVxuXG4gIHRlYXJkb3duICgpIHtcbiAgICBsb2cuZGVidWcoJ0NsZWFuaW5nIHVwIGxpc3RlbmVycycpO1xuXG4gICAgdGhpcy5hcHBEaWN0ID0ge307XG4gICAgdGhpcy5hcHBJZEtleSA9IG51bGw7XG4gICAgdGhpcy5wYWdlSWRLZXkgPSBudWxsO1xuICAgIHRoaXMucGFnZUxvYWRpbmcgPSBmYWxzZTtcblxuICAgIHRoaXMuc3BlY2lhbENicyA9IHt9O1xuXG4gICAgdGhpcy5ycGNDbGllbnQgPSBudWxsO1xuXG4gICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoUmVtb3RlRGVidWdnZXIuRVZFTlRfUEFHRV9DSEFOR0UpO1xuICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKFJlbW90ZURlYnVnZ2VyLkVWRU5UX0RJU0NPTk5FQ1QpO1xuICB9XG5cbiAgYXN5bmMgY29ubmVjdCAoKSB7XG4gICAgdGhpcy5zZXR1cCgpO1xuXG4gICAgLy8gaW5pdGlhbGl6ZSB0aGUgcnBjIGNsaWVudFxuICAgIHRoaXMucnBjQ2xpZW50ID0gbmV3IFJwY0NsaWVudFNpbXVsYXRvcih7XG4gICAgICBidW5kbGVJZDogdGhpcy5idW5kbGVJZCxcbiAgICAgIHBsYXRmb3JtVmVyc2lvbjogdGhpcy5wbGF0Zm9ybVZlcnNpb24sXG4gICAgICBpc1NhZmFyaTogdGhpcy5pc1NhZmFyaSxcbiAgICAgIGhvc3Q6IHRoaXMuaG9zdCxcbiAgICAgIHBvcnQ6IHRoaXMucG9ydCxcbiAgICAgIHNvY2tldFBhdGg6IHRoaXMuc29ja2V0UGF0aCxcbiAgICAgIHNwZWNpYWxNZXNzYWdlSGFuZGxlcnM6IHRoaXMuc3BlY2lhbENicyxcbiAgICAgIG1lc3NhZ2VQcm94eTogdGhpcy5yZW1vdGVEZWJ1Z1Byb3h5LFxuICAgICAgbG9nQWxsQ29tbXVuaWNhdGlvbjogdGhpcy5sb2dBbGxDb21tdW5pY2F0aW9uLFxuICAgICAgbG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXA6IHRoaXMubG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXAsXG4gICAgfSk7XG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuY29ubmVjdCgpO1xuXG4gICAgLy8gZ2V0IHRoZSBjb25uZWN0aW9uIGluZm9ybWF0aW9uIGFib3V0IHRoZSBhcHBcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zZXRDb25uZWN0aW9uS2V5KCk7XG4gICAgICByZXR1cm4gdGhpcy5hcHBEaWN0IHx8IHt9O1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLmVycm9yKGBFcnJvciBzZXR0aW5nIGNvbm5lY3Rpb24ga2V5OiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgYXdhaXQgdGhpcy5kaXNjb25uZWN0KCk7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZGlzY29ubmVjdCAoKSB7XG4gICAgaWYgKHRoaXMucnBjQ2xpZW50KSB7XG4gICAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5kaXNjb25uZWN0KCk7XG4gICAgfVxuICAgIHRoaXMuZW1pdChSZW1vdGVEZWJ1Z2dlci5FVkVOVF9ESVNDT05ORUNULCB0cnVlKTtcbiAgICB0aGlzLnRlYXJkb3duKCk7XG4gIH1cblxuICBpc0Nvbm5lY3RlZCAoKSB7XG4gICAgcmV0dXJuICEhKHRoaXMucnBjQ2xpZW50ICYmIHRoaXMucnBjQ2xpZW50LmlzQ29ubmVjdGVkKCkpO1xuICB9XG5cbiAgYXN5bmMgc2V0Q29ubmVjdGlvbktleSAoKSB7XG4gICAgbG9nLmRlYnVnKCdTZW5kaW5nIGNvbm5lY3Rpb24ga2V5IHJlcXVlc3QnKTtcbiAgICAvLyBzZW5kIGJ1dCBvbmx5IHdhaXQgdG8gbWFrZSBzdXJlIHRoZSBzb2NrZXQgd29ya2VkXG4gICAgLy8gYXMgcmVzcG9uc2UgZnJvbSBXZWIgSW5zcGVjdG9yIGNhbiB0YWtlIGEgbG9uZyB0aW1lXG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnc2V0Q29ubmVjdGlvbktleScsIHt9LCBmYWxzZSk7XG4gIH1cblxuICB1cGRhdGVBcHBzV2l0aERpY3QgKGRpY3QpIHtcbiAgICAvLyBnZXQgdGhlIGRpY3Rpb25hcnkgZW50cnkgaW50byBhIG5pY2UgZm9ybSwgYW5kIGFkZCBpdCB0byB0aGVcbiAgICAvLyBhcHBsaWNhdGlvbiBkaWN0aW9uYXJ5XG4gICAgdGhpcy5hcHBEaWN0ID0gdGhpcy5hcHBEaWN0IHx8IHt9O1xuICAgIGxldCBbaWQsIGVudHJ5XSA9IGFwcEluZm9Gcm9tRGljdChkaWN0KTtcbiAgICBpZiAodGhpcy5hcHBEaWN0W2lkXSkge1xuICAgICAgLy8gcHJlc2VydmUgdGhlIHBhZ2UgZGljdGlvbmFyeSBmb3IgdGhpcyBlbnRyeVxuICAgICAgZW50cnkucGFnZUFycmF5ID0gdGhpcy5hcHBEaWN0W2lkXS5wYWdlQXJyYXk7XG4gICAgfVxuICAgIHRoaXMuYXBwRGljdFtpZF0gPSBlbnRyeTtcblxuICAgIC8vIGFkZCBhIHByb21pc2UgdG8gZ2V0IHRoZSBwYWdlIGRpY3Rpb25hcnlcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChlbnRyeS5wYWdlQXJyYXkpKSB7XG4gICAgICBlbnRyeS5wYWdlQXJyYXkgPSBkZWZlcnJlZFByb21pc2UoKTtcbiAgICB9XG5cbiAgICAvLyB0cnkgdG8gZ2V0IHRoZSBhcHAgaWQgZnJvbSBvdXIgY29ubmVjdGVkIGFwcHNcbiAgICBpZiAoIXRoaXMuYXBwSWRLZXkpIHtcbiAgICAgIHRoaXMuYXBwSWRLZXkgPSBnZXREZWJ1Z2dlckFwcEtleSh0aGlzLmJ1bmRsZUlkLCB0aGlzLmFwcERpY3QpO1xuICAgIH1cbiAgfVxuXG4gIGxvZ0FwcGxpY2F0aW9uRGljdGlvbmFyeSAoYXBwcykge1xuICAgIGZ1bmN0aW9uIGdldFZhbHVlU3RyaW5nIChrZXksIHZhbHVlKSB7XG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gJ1tGdW5jdGlvbl0nO1xuICAgICAgfVxuICAgICAgaWYgKGtleSA9PT0gJ3BhZ2VBcnJheScgJiYgIV8uaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIGAnV2FpdGluZyBmb3IgZGF0YSdgO1xuICAgICAgfVxuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgICB9XG4gICAgbG9nLmRlYnVnKCdDdXJyZW50IGFwcGxpY2F0aW9ucyBhdmFpbGFibGU6Jyk7XG4gICAgZm9yIChjb25zdCBbYXBwLCBpbmZvXSBvZiBfLnRvUGFpcnMoYXBwcykpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgICAgIEFwcGxpY2F0aW9uOiAnJHthcHB9J2ApO1xuICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgXy50b1BhaXJzKGluZm8pKSB7XG4gICAgICAgIGlmIChrZXkgPT09ICdwYWdlQXJyYXknICYmIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmxlbmd0aCkge1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgICAgICAgICAke2tleX06YCk7XG4gICAgICAgICAgZm9yIChjb25zdCBwYWdlIG9mIHZhbHVlKSB7XG4gICAgICAgICAgICBsZXQgcHJlZml4ID0gJy0gJztcbiAgICAgICAgICAgIGZvciAoY29uc3QgW2ssIHZdIG9mIF8udG9QYWlycyhwYWdlKSkge1xuICAgICAgICAgICAgICBsb2cuZGVidWcoYCAgICAgICAgICAke3ByZWZpeH0ke2t9OiAke0pTT04uc3RyaW5naWZ5KHYpfWApO1xuICAgICAgICAgICAgICBwcmVmaXggPSAnICAnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCB2YWx1ZVN0cmluZyA9IGdldFZhbHVlU3RyaW5nKGtleSwgdmFsdWUpO1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgICAgICAgICAke2tleX06ICR7dmFsdWVTdHJpbmd9YCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc3luYyBzZWxlY3RBcHAgKGN1cnJlbnRVcmwgPSBudWxsLCBtYXhUcmllcyA9IFNFTEVDVF9BUFBfUkVUUklFUywgaWdub3JlQWJvdXRCbGFua1VybCA9IGZhbHNlKSB7XG4gICAgY29uc3Qgc2hvdWxkQ2hlY2tGb3JUYXJnZXQgPSB0aGlzLnJwY0NsaWVudC5zaG91bGRDaGVja0ZvclRhcmdldDtcbiAgICB0aGlzLnJwY0NsaWVudC5zaG91bGRDaGVja0ZvclRhcmdldCA9IGZhbHNlO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBwcm9jZXNzLmhydGltZSgpO1xuICAgICAgbG9nLmRlYnVnKCdTZWxlY3RpbmcgYXBwbGljYXRpb24nKTtcbiAgICAgIGlmICghdGhpcy5hcHBEaWN0IHx8IF8uaXNFbXB0eSh0aGlzLmFwcERpY3QpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZygnTm8gYXBwbGljYXRpb25zIGN1cnJlbnRseSBjb25uZWN0ZWQuJyk7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBhcHBJZEtleSwgcGFnZURpY3QgfSA9IGF3YWl0IHRoaXMuc2VhcmNoRm9yQXBwKGN1cnJlbnRVcmwsIG1heFRyaWVzLCBpZ25vcmVBYm91dEJsYW5rVXJsKTtcblxuICAgICAgLy8gaWYsIGFmdGVyIGFsbCB0aGlzLCB3ZSBoYXZlIG5vIGRpY3Rpb25hcnksIHdlIGhhdmUgZmFpbGVkXG4gICAgICBpZiAoIWFwcElkS2V5IHx8ICFwYWdlRGljdCkge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IGNvbm5lY3QgdG8gYSB2YWxpZCBhcHAgYWZ0ZXIgJHttYXhUcmllc30gdHJpZXMuYCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmFwcElkS2V5ICE9PSBhcHBJZEtleSkge1xuICAgICAgICBsb2cuZGVidWcoYFJlY2VpdmVkIGFsdGVyZWQgYXBwIGlkLCB1cGRhdGluZyBmcm9tICcke3RoaXMuYXBwSWRLZXl9JyB0byAnJHthcHBJZEtleX0nYCk7XG4gICAgICAgIHRoaXMuYXBwSWRLZXkgPSBhcHBJZEtleTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dBcHBsaWNhdGlvbkRpY3Rpb25hcnkodGhpcy5hcHBEaWN0KTtcblxuICAgICAgLy8gdHJhbnNsYXRlIHRoZSBkaWN0aW9uYXJ5IGludG8gYSB1c2VmdWwgZm9ybSwgYW5kIHJldHVybiB0byBzZW5kZXJcbiAgICAgIGNvbnN0IHBhZ2VBcnJheSA9IF8uaXNFbXB0eSh0aGlzLmFwcERpY3RbYXBwSWRLZXldLnBhZ2VBcnJheSlcbiAgICAgICAgPyBwYWdlQXJyYXlGcm9tRGljdChwYWdlRGljdClcbiAgICAgICAgOiB0aGlzLmFwcERpY3RbYXBwSWRLZXldLnBhZ2VBcnJheTtcbiAgICAgIGxvZy5kZWJ1ZyhgRmluYWxseSBzZWxlY3RpbmcgYXBwICR7dGhpcy5hcHBJZEtleX06ICR7c2ltcGxlU3RyaW5naWZ5KHBhZ2VBcnJheSl9YCk7XG5cbiAgICAgIGxldCBmdWxsUGFnZUFycmF5ID0gW107XG4gICAgICBmb3IgKGNvbnN0IFthcHAsIGluZm9dIG9mIF8udG9QYWlycyh0aGlzLmFwcERpY3QpKSB7XG4gICAgICAgIGlmICghXy5pc0FycmF5KGluZm8ucGFnZUFycmF5KSB8fCBpbmZvLmlzQWN0aXZlID09PSBBQ1RJVkVfQVBQX0NPREUpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpZCA9IGFwcC5yZXBsYWNlKCdQSUQ6JywgJycpO1xuICAgICAgICBmb3IgKGNvbnN0IHBhZ2Ugb2YgaW5mby5wYWdlQXJyYXkpIHtcbiAgICAgICAgICBpZiAocGFnZS51cmwgJiYgKCFpZ25vcmVBYm91dEJsYW5rVXJsIHx8IHBhZ2UudXJsICE9PSBCTEFOS19QQUdFX1VSTCkpIHtcbiAgICAgICAgICAgIGxldCBwYWdlRGljdCA9IF8uY2xvbmUocGFnZSk7XG4gICAgICAgICAgICBwYWdlRGljdC5pZCA9IGAke2lkfS4ke3BhZ2VEaWN0LmlkfWA7XG4gICAgICAgICAgICBmdWxsUGFnZUFycmF5LnB1c2gocGFnZURpY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBsb2cuZGVidWcoYFNlbGVjdGVkIGFwcCBhZnRlciAke2dldEVsYXBzZWRUaW1lKHN0YXJ0VGltZSl9bXNgKTtcbiAgICAgIHJldHVybiBmdWxsUGFnZUFycmF5O1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0aGlzLnJwY0NsaWVudC5zaG91bGRDaGVja0ZvclRhcmdldCA9IHNob3VsZENoZWNrRm9yVGFyZ2V0O1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNlYXJjaEZvckFwcCAoY3VycmVudFVybCwgbWF4VHJpZXMsIGlnbm9yZUFib3V0QmxhbmtVcmwpIHtcbiAgICBjb25zdCBidW5kbGVJZHMgPSB0aGlzLmluY2x1ZGVTYWZhcmkgJiYgIXRoaXMuaXNTYWZhcmlcbiAgICAgID8gW3RoaXMuYnVuZGxlSWQsIFNBRkFSSV9CVU5ETEVfSURdXG4gICAgICA6IFt0aGlzLmJ1bmRsZUlkXTtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHJldHJ5SW50ZXJ2YWwobWF4VHJpZXMsIFNFTEVDVF9BUFBfUkVUUllfU0xFRVBfTVMsIGFzeW5jIChyZXRyeUNvdW50KSA9PiB7XG4gICAgICAgIHRoaXMubG9nQXBwbGljYXRpb25EaWN0aW9uYXJ5KHRoaXMuYXBwRGljdCk7XG4gICAgICAgIGNvbnN0IHBvc3NpYmxlQXBwSWRzID0gZ2V0UG9zc2libGVEZWJ1Z2dlckFwcEtleXMoYnVuZGxlSWRzLCB0aGlzLmFwcERpY3QpO1xuICAgICAgICBsb2cuZGVidWcoYFRyeWluZyBvdXQgdGhlIHBvc3NpYmxlIGFwcCBpZHM6ICR7cG9zc2libGVBcHBJZHMuam9pbignLCAnKX0gKHRyeSAjJHtyZXRyeUNvdW50ICsgMX0gb2YgJHttYXhUcmllc30pYCk7XG4gICAgICAgIGZvciAoY29uc3QgYXR0ZW1wdGVkQXBwSWRLZXkgb2YgcG9zc2libGVBcHBJZHMpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYXBwRGljdFthdHRlbXB0ZWRBcHBJZEtleV0uaXNBY3RpdmUgPT09IEFDVElWRV9BUFBfQ09ERSkge1xuICAgICAgICAgICAgICBsb2cuZGVidWcoYFNraXBwaW5nIGFwcCAnJHthdHRlbXB0ZWRBcHBJZEtleX0nIGJlY2F1c2UgaXQgaXMgbm90IGFjdGl2ZWApO1xuICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxvZy5kZWJ1ZyhgQXR0ZW1wdGluZyBhcHAgJyR7YXR0ZW1wdGVkQXBwSWRLZXl9J2ApO1xuICAgICAgICAgICAgY29uc3QgW2FwcElkS2V5LCBwYWdlRGljdF0gPSBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZWxlY3RBcHAoYXR0ZW1wdGVkQXBwSWRLZXksIHRoaXMub25BcHBDb25uZWN0LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgLy8gaW4gaU9TIDguMiB0aGUgY29ubmVjdCBsb2dpYyBoYXBwZW5zLCBidXQgd2l0aCBhbiBlbXB0eSBkaWN0aW9uYXJ5XG4gICAgICAgICAgICAvLyB3aGljaCBsZWFkcyB0byB0aGUgcmVtb3RlIGRlYnVnZ2VyIGdldHRpbmcgZGlzY29ubmVjdGVkLCBhbmQgaW50byBhIGxvb3BcbiAgICAgICAgICAgIGlmIChfLmlzRW1wdHkocGFnZURpY3QpKSB7XG4gICAgICAgICAgICAgIGxvZy5kZWJ1ZygnRW1wdHkgcGFnZSBkaWN0aW9uYXJ5IHJlY2VpdmVkLiBUcnlpbmcgYWdhaW4uJyk7XG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzYXZlIHRoZSBwYWdlIGFycmF5IGZvciB0aGlzIGFwcFxuICAgICAgICAgICAgdGhpcy5hcHBEaWN0W2FwcElkS2V5XS5wYWdlQXJyYXkgPSBwYWdlQXJyYXlGcm9tRGljdChwYWdlRGljdCk7XG5cbiAgICAgICAgICAgIC8vIGlmIHdlIGFyZSBsb29raW5nIGZvciBhIHBhcnRpY3VsYXIgdXJsLCBtYWtlIHN1cmUgd2VcbiAgICAgICAgICAgIC8vIGhhdmUgdGhlIHJpZ2h0IHBhZ2UuIElnbm9yZSBlbXB0eSBvciB1bmRlZmluZWQgdXJscy5cbiAgICAgICAgICAgIC8vIElnbm9yZSBhYm91dDpibGFuayBpZiByZXF1ZXN0ZWQuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnNlYXJjaEZvclBhZ2UodGhpcy5hcHBEaWN0LCBjdXJyZW50VXJsLCBpZ25vcmVBYm91dEJsYW5rVXJsKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGN1cnJlbnRVcmwpIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKGBSZWNlaXZlZCBhcHAsIGJ1dCBleHBlY3RlZCB1cmwgKCcke2N1cnJlbnRVcmx9Jykgd2FzIG5vdCBmb3VuZC4gVHJ5aW5nIGFnYWluLmApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKCdSZWNlaXZlZCBhcHAsIGJ1dCBubyBtYXRjaCB3YXMgZm91bmQuIFRyeWluZyBhZ2Fpbi4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGxvZy5kZWJ1ZyhgRXJyb3IgY2hlY2tpbmcgYXBwbGljYXRpb246ICcke2Vyci5tZXNzYWdlfScuIFJldHJ5aW5nIGNvbm5lY3Rpb25gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0cnlDb3VudCsrO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBmaW5kIGFuIGFwcCB0byBzZWxlY3QnKTtcbiAgICAgIH0sIDApO1xuICAgIH0gY2F0Y2ggKGlnbikge1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBjb25uZWN0IHRvIGEgdmFsaWQgYXBwIGFmdGVyICR7bWF4VHJpZXN9IHRyaWVzLmApO1xuICAgIH1cbiAgfVxuXG4gIHNlYXJjaEZvclBhZ2UgKGFwcHNEaWN0LCBjdXJyZW50VXJsID0gbnVsbCwgaWdub3JlQWJvdXRCbGFua1VybCA9IGZhbHNlKSB7XG4gICAgZm9yIChjb25zdCBhcHBEaWN0IG9mIF8udmFsdWVzKGFwcHNEaWN0KSkge1xuICAgICAgaWYgKCFhcHBEaWN0IHx8IGFwcERpY3QuaXNBY3RpdmUgPT09IEFDVElWRV9BUFBfQ09ERSB8fCAhYXBwRGljdC5wYWdlQXJyYXkgfHwgYXBwRGljdC5wYWdlQXJyYXkucHJvbWlzZSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgZm9yIChjb25zdCBkaWN0IG9mIGFwcERpY3QucGFnZUFycmF5KSB7XG4gICAgICAgIGlmICgoIWlnbm9yZUFib3V0QmxhbmtVcmwgfHwgZGljdC51cmwgIT09IEJMQU5LX1BBR0VfVVJMKSAmJlxuICAgICAgICAgICAgKCFjdXJyZW50VXJsIHx8IGRpY3QudXJsID09PSBjdXJyZW50VXJsIHx8IGRpY3QudXJsID09PSBgJHtjdXJyZW50VXJsfS9gKSkge1xuICAgICAgICAgIHJldHVybiB7IGFwcElkS2V5OiBhcHBEaWN0LmlkLCBwYWdlRGljdDogZGljdCB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgYXN5bmMgc2VsZWN0UGFnZSAoYXBwSWRLZXksIHBhZ2VJZEtleSwgc2tpcFJlYWR5Q2hlY2sgPSBmYWxzZSkge1xuICAgIHRoaXMuYXBwSWRLZXkgPSBgUElEOiR7YXBwSWRLZXl9YDtcbiAgICB0aGlzLnBhZ2VJZEtleSA9IHBhZ2VJZEtleTtcblxuICAgIGxvZy5kZWJ1ZyhgU2VsZWN0aW5nIHBhZ2UgJyR7cGFnZUlkS2V5fScgb24gYXBwICcke3RoaXMuYXBwSWRLZXl9JyBhbmQgZm9yd2FyZGluZyBzb2NrZXQgc2V0dXBgKTtcblxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IHByb2Nlc3MuaHJ0aW1lKCk7XG5cbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZWxlY3RQYWdlKHRoaXMuYXBwSWRLZXksIHBhZ2VJZEtleSk7XG5cbiAgICAvLyBtYWtlIHN1cmUgZXZlcnl0aGluZyBpcyByZWFkeSB0byBnb1xuICAgIGlmICghc2tpcFJlYWR5Q2hlY2sgJiYgIWF3YWl0IHRoaXMuY2hlY2tQYWdlSXNSZWFkeSgpKSB7XG4gICAgICBhd2FpdCB0aGlzLnBhZ2VVbmxvYWQoKTtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYFNlbGVjdGVkIHBhZ2UgYWZ0ZXIgJHtnZXRFbGFwc2VkVGltZShzdGFydFRpbWUpfW1zYCk7XG4gIH1cblxuICBhc3luYyBleGVjdXRlQXRvbSAoYXRvbSwgYXJncywgZnJhbWVzKSB7XG4gICAgaWYgKCF0aGlzLnJwY0NsaWVudC5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlbW90ZSBkZWJ1Z2dlciBpcyBub3QgY29ubmVjdGVkJyk7XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKGBFeGVjdXRpbmcgYXRvbSAnJHthdG9tfSdgKTtcbiAgICBjb25zdCBzY3JpcHQgPSBhd2FpdCBnZXRTY3JpcHRGb3JBdG9tKGF0b20sIGFyZ3MsIGZyYW1lcyk7XG4gICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLmV4ZWN1dGUoc2NyaXB0LCB0cnVlKTtcbiAgICBsb2cuZGVidWcoYFJlY2VpdmVkIHJlc3VsdCBmb3IgYXRvbSAnJHthdG9tfScgZXhlY3V0aW9uOiAke18udHJ1bmNhdGUoc2ltcGxlU3RyaW5naWZ5KHZhbHVlKSwge2xlbmd0aDogUkVTUE9OU0VfTE9HX0xFTkdUSH0pfWApO1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGVBdG9tQXN5bmMgKGF0b20sIGFyZ3MsIGZyYW1lcykge1xuICAgIC8vIGZpcnN0IGNyZWF0ZSBhIFByb21pc2Ugb24gdGhlIHBhZ2UsIHNhdmluZyB0aGUgcmVzb2x2ZS9yZWplY3QgZnVuY3Rpb25zXG4gICAgLy8gYXMgcHJvcGVydGllc1xuICAgIGNvbnN0IHByb21pc2VOYW1lID0gYGFwcGl1bUFzeW5jRXhlY3V0ZVByb21pc2Uke1VVSUQuY3JlYXRlKCkudG9TdHJpbmcoKS5yZXBsYWNlKC8tL2csICcnKX1gO1xuICAgIGxldCBzY3JpcHQgPSBgdmFyIHJlcywgcmVqO2AgK1xuICAgICAgICAgICAgICAgICBgd2luZG93LiR7cHJvbWlzZU5hbWV9ID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge2AgK1xuICAgICAgICAgICAgICAgICBgICByZXMgPSByZXNvbHZlO2AgK1xuICAgICAgICAgICAgICAgICBgICByZWogPSByZWplY3Q7YCArXG4gICAgICAgICAgICAgICAgIGB9KTtgICtcbiAgICAgICAgICAgICAgICAgYHdpbmRvdy4ke3Byb21pc2VOYW1lfS5yZXNvbHZlID0gcmVzO2AgK1xuICAgICAgICAgICAgICAgICBgd2luZG93LiR7cHJvbWlzZU5hbWV9LnJlamVjdCA9IHJlajtgICtcbiAgICAgICAgICAgICAgICAgYHdpbmRvdy4ke3Byb21pc2VOYW1lfTtgO1xuICAgIGNvbnN0IG9iaiA9IGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3NlbmRKU0NvbW1hbmQnLCB7XG4gICAgICBjb21tYW5kOiBzY3JpcHQsXG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICByZXR1cm5CeVZhbHVlOiBmYWxzZSxcbiAgICB9KTtcbiAgICBjb25zdCBwcm9taXNlT2JqZWN0SWQgPSBvYmoucmVzdWx0Lm9iamVjdElkO1xuXG4gICAgLy8gZXhlY3V0ZSB0aGUgYXRvbSwgY2FsbGluZyBiYWNrIHRvIHRoZSByZXNvbHZlIGZ1bmN0aW9uXG4gICAgY29uc3QgYXN5bmNDYWxsQmFjayA9IGBmdW5jdGlvbiAocmVzKSB7YCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGAgIHdpbmRvdy4ke3Byb21pc2VOYW1lfS5yZXNvbHZlKHJlcyk7YCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGAgIHdpbmRvdy4ke3Byb21pc2VOYW1lfVZhbHVlID0gcmVzO2AgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBgfWA7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlKGF3YWl0IGdldFNjcmlwdEZvckF0b20oYXRvbSwgYXJncywgZnJhbWVzLCBhc3luY0NhbGxCYWNrKSk7XG5cbiAgICAvLyB3YWl0IGZvciB0aGUgcHJvbWlzZSB0byBiZSByZXNvbHZlZFxuICAgIGxldCByZXM7XG4gICAgY29uc3Qgc3ViY29tbWFuZFRpbWVvdXQgPSAxMDAwOyAvLyB0aW1lb3V0IG9uIGluZGl2aWR1YWwgY29tbWFuZHNcbiAgICB0cnkge1xuICAgICAgcmVzID0gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnYXdhaXRQcm9taXNlJywge1xuICAgICAgICBwcm9taXNlT2JqZWN0SWQsXG4gICAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoIWVyci5tZXNzYWdlLmluY2x1ZGVzKGAnUnVudGltZS5hd2FpdFByb21pc2UnIHdhcyBub3QgZm91bmRgKSkge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG5cbiAgICAgIC8vIGF3YWl0UHJvbWlzZSBpcyBub3QgYWx3YXlzIGF2YWlsYWJsZSwgc28gc2ltdWxhdGUgaXQgd2l0aCBwb2xsXG4gICAgICBjb25zdCByZXRyeVdhaXQgPSAxMDA7XG4gICAgICBjb25zdCB0aW1lb3V0ID0gKGFyZ3MubGVuZ3RoID49IDMpID8gYXJnc1syXSA6IFJQQ19SRVNQT05TRV9USU1FT1VUX01TO1xuICAgICAgY29uc3QgcmV0cmllcyA9IHBhcnNlSW50KHRpbWVvdXQgLyByZXRyeVdhaXQsIDEwKTtcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHByb2Nlc3MuaHJ0aW1lKCk7XG4gICAgICByZXMgPSBhd2FpdCByZXRyeUludGVydmFsKHJldHJpZXMsIHJldHJ5V2FpdCwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyB0aGUgYXRvbSBfd2lsbF8gcmV0dXJuLCBlaXRoZXIgYmVjYXVzZSBpdCBmaW5pc2hlZCBvciBhbiBlcnJvclxuICAgICAgICAvLyBpbmNsdWRpbmcgYSB0aW1lb3V0IGVycm9yXG4gICAgICAgIGlmIChhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdleGVjdXRlX3NjcmlwdCcsIFtgcmV0dXJuIHdpbmRvdy5oYXNPd25Qcm9wZXJ0eSgnJHtwcm9taXNlTmFtZX1WYWx1ZScpO2AsIFtudWxsLCBudWxsXSwgc3ViY29tbWFuZFRpbWVvdXRdLCBmcmFtZXMpKSB7XG4gICAgICAgICAgLy8gd2Ugb25seSBwdXQgdGhlIHByb3BlcnR5IG9uIGB3aW5kb3dgIHdoZW4gdGhlIGNhbGxiYWNrIGlzIGNhbGxlZCxcbiAgICAgICAgICAvLyBzbyBpZiBpdCBpcyB0aGVyZSwgZXZlcnl0aGluZyBpcyBkb25lXG4gICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2V4ZWN1dGVfc2NyaXB0JywgW2ByZXR1cm4gd2luZG93LiR7cHJvbWlzZU5hbWV9VmFsdWU7YCwgW251bGwsIG51bGxdLCBzdWJjb21tYW5kVGltZW91dF0sIGZyYW1lcyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdGhyb3cgYSBUaW1lb3V0RXJyb3IsIG9yIGVsc2UgaXQgbmVlZHMgdG8gYmUgY2F1Z2h0IGFuZCByZS10aHJvd25cbiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5UaW1lb3V0RXJyb3IoYFRpbWVkIG91dCB3YWl0aW5nIGZvciBhc3luY2hyb25vdXMgc2NyaXB0IGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgcmVzdWx0IGFmdGVyICR7Z2V0RWxhcHNlZFRpbWUoc3RhcnRUaW1lKX0gbXMnKSk7YCk7XG4gICAgICB9KTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gdHJ5IHRvIGdldCByaWQgb2YgdGhlIHByb21pc2VcbiAgICAgICAgYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZXhlY3V0ZV9zY3JpcHQnLCBbYGRlbGV0ZSB3aW5kb3cuJHtwcm9taXNlTmFtZX07YCwgW251bGwsIG51bGxdLCBzdWJjb21tYW5kVGltZW91dF0sIGZyYW1lcyk7XG4gICAgICB9IGNhdGNoIChpZ24pIHt9XG4gICAgfVxuICAgIHJldHVybiBjb252ZXJ0UmVzdWx0KHJlcyk7XG4gIH1cblxuICBmcmFtZURldGFjaGVkICgpIHtcbiAgICB0aGlzLmVtaXQoUmVtb3RlRGVidWdnZXIuRVZFTlRfRlJBTUVTX0RFVEFDSEVEKTtcbiAgfVxuXG4gIGFzeW5jIHBhZ2VMb2FkIChzdGFydFBhZ2VMb2FkTXMsIHBhZ2VMb2FkVmVyaWZ5SG9vaykge1xuICAgIGxldCB0aW1lb3V0TXMgPSA1MDA7XG4gICAgbGV0IHN0YXJ0ID0gc3RhcnRQYWdlTG9hZE1zIHx8IERhdGUubm93KCk7XG5cbiAgICBsb2cuZGVidWcoJ1BhZ2UgbG9hZGVkLCB2ZXJpZnlpbmcgd2hldGhlciByZWFkeScpO1xuICAgIHRoaXMucGFnZUxvYWRpbmcgPSB0cnVlO1xuXG4gICAgY29uc3QgdmVyaWZ5ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgdGhpcy5wYWdlTG9hZERlbGF5ID0gdXRpbC5jYW5jZWxsYWJsZURlbGF5KHRpbWVvdXRNcyk7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnBhZ2VMb2FkRGVsYXk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIEIuQ2FuY2VsbGF0aW9uRXJyb3IpIHtcbiAgICAgICAgICAvLyBpZiB0aGUgcHJvbWlzZSBoYXMgYmVlbiBjYW5jZWxsZWRcbiAgICAgICAgICAvLyB3ZSB3YW50IHRvIHNraXAgY2hlY2tpbmcgdGhlIHJlYWRpbmVzc1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyB3ZSBjYW4gZ2V0IHRoaXMgY2FsbGVkIGluIHRoZSBtaWRkbGUgb2YgdHJ5aW5nIHRvIGZpbmQgYSBuZXcgYXBwXG4gICAgICBpZiAoIXRoaXMuYXBwSWRLZXkpIHtcbiAgICAgICAgbG9nLmRlYnVnKCdOb3QgY29ubmVjdGVkIHRvIGFuIGFwcGxpY2F0aW9uLiBJZ25vcmluZyBwYWdlIGxvYWQnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKHBhZ2VMb2FkVmVyaWZ5SG9vaykpIHtcbiAgICAgICAgYXdhaXQgcGFnZUxvYWRWZXJpZnlIb29rKCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlYWR5ID0gYXdhaXQgdGhpcy5jaGVja1BhZ2VJc1JlYWR5KCk7XG5cbiAgICAgIC8vIGlmIHdlIGFyZSByZWFkeSwgb3Igd2UndmUgc3BlbmQgdG9vIG11Y2ggdGltZSBvbiB0aGlzXG4gICAgICBpZiAocmVhZHkgfHwgKHRoaXMucGFnZUxvYWRNcyA+IDAgJiYgKHN0YXJ0ICsgdGhpcy5wYWdlTG9hZE1zKSA8IERhdGUubm93KCkpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZygnUGFnZSBpcyByZWFkeScpO1xuICAgICAgICB0aGlzLnBhZ2VMb2FkaW5nID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2cuZGVidWcoJ1BhZ2Ugd2FzIG5vdCByZWFkeSwgcmV0cnlpbmcnKTtcbiAgICAgICAgYXdhaXQgdmVyaWZ5KCk7XG4gICAgICB9XG4gICAgfTtcbiAgICBhd2FpdCB2ZXJpZnkoKTtcbiAgfVxuXG4gIGNhbmNlbFBhZ2VMb2FkICgpIHtcbiAgICBsb2cuZGVidWcoJ1VucmVnaXN0ZXJpbmcgZnJvbSBwYWdlIHJlYWRpbmVzcyBub3RpZmljYXRpb25zJyk7XG4gICAgdGhpcy5wYWdlTG9hZGluZyA9IGZhbHNlO1xuICAgIGlmICh0aGlzLnBhZ2VMb2FkRGVsYXkpIHtcbiAgICAgIHRoaXMucGFnZUxvYWREZWxheS5jYW5jZWwoKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBwYWdlVW5sb2FkICgpIHtcbiAgICBsb2cuZGVidWcoJ1BhZ2UgdW5sb2FkaW5nJyk7XG4gICAgYXdhaXQgdGhpcy53YWl0Rm9yRG9tKCk7XG4gIH1cblxuICBhc3luYyB3YWl0Rm9yRG9tIChzdGFydFBhZ2VMb2FkTXMsIHBhZ2VMb2FkVmVyaWZ5SG9vaykge1xuICAgIGxvZy5kZWJ1ZygnV2FpdGluZyBmb3IgZG9tLi4uJyk7XG4gICAgYXdhaXQgdGhpcy5wYWdlTG9hZChzdGFydFBhZ2VMb2FkTXMsIHBhZ2VMb2FkVmVyaWZ5SG9vayk7XG4gIH1cblxuICBhc3luYyBjaGVja1BhZ2VJc1JlYWR5ICgpIHtcbiAgICBjb25zdCBlcnJvcnMgPSBjaGVja1BhcmFtcyh7YXBwSWRLZXk6IHRoaXMuYXBwSWRLZXl9KTtcbiAgICBpZiAoZXJyb3JzKSB0aHJvdyBuZXcgRXJyb3IoZXJyb3JzKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgbG9nLmRlYnVnKCdDaGVja2luZyBkb2N1bWVudCByZWFkeVN0YXRlJyk7XG4gICAgY29uc3QgcmVhZHlDbWQgPSAnZG9jdW1lbnQucmVhZHlTdGF0ZTsnO1xuICAgIGxldCByZWFkeVN0YXRlID0gJ2xvYWRpbmcnO1xuICAgIHRyeSB7XG4gICAgICByZWFkeVN0YXRlID0gYXdhaXQgQi5yZXNvbHZlKHRoaXMuZXhlY3V0ZShyZWFkeUNtZCwgdHJ1ZSkpLnRpbWVvdXQodGhpcy5wYWdlUmVhZHlUaW1lb3V0KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghKGVyciBpbnN0YW5jZW9mIEIuVGltZW91dEVycm9yKSkge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICBsb2cuZGVidWcoYFBhZ2UgcmVhZGluZXNzIGNoZWNrIHRpbWVkIG91dCBhZnRlciAke3RoaXMucGFnZVJlYWR5VGltZW91dH1tc2ApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBsb2cuZGVidWcoYERvY3VtZW50IHJlYWR5U3RhdGUgaXMgJyR7cmVhZHlTdGF0ZX0nYCk7XG5cbiAgICByZXR1cm4gcmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJztcbiAgfVxuXG4gIGFzeW5jIGxhdW5jaFNhZmFyaSAoKSB7XG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnbGF1bmNoQXBwbGljYXRpb24nLCB7XG4gICAgICBidW5kbGVJZDogU0FGQVJJX0JVTkRMRV9JRFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgbmF2VG9VcmwgKHVybCwgcGFnZUxvYWRWZXJpZnlIb29rKSB7XG4gICAgY29uc3QgZXJyb3JzID0gY2hlY2tQYXJhbXMoe2FwcElkS2V5OiB0aGlzLmFwcElkS2V5LCBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5fSk7XG4gICAgaWYgKGVycm9ycykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9ycyk7XG4gICAgfVxuXG4gICAgdGhpcy5fbmF2aWdhdGluZ1RvUGFnZSA9IHRydWU7XG5cbiAgICB0cnkge1xuICAgICAgbG9nLmRlYnVnKGBOYXZpZ2F0aW5nIHRvIG5ldyBVUkw6ICcke3VybH0nYCk7XG5cbiAgICAgIC8vIGJlZ2luIGxpc3RlbmluZyBmb3IgZnJhbWUgbmF2aWdhdGlvbiBldmVudCwgd2hpY2ggd2lsbCBiZSB3YWl0ZWQgZm9yIGxhdGVyXG4gICAgICBjb25zdCB3YWl0Rm9yRnJhbWVQcm9taXNlID0gdGhpcy53YWl0Rm9yRnJhbWVOYXZpZ2F0ZWQoKTtcblxuICAgICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnc2V0VXJsJywge1xuICAgICAgICB1cmwsXG4gICAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghdGhpcy51c2VOZXdTYWZhcmkpIHtcbiAgICAgICAgLy8gYSBzbWFsbCBwYXVzZSBmb3IgdGhlIGJyb3dzZXIgdG8gY2F0Y2ggdXBcbiAgICAgICAgYXdhaXQgQi5kZWxheSgxMDAwKTtcbiAgICAgIH1cblxuICAgICAgLy8gd2FpdCB1bnRpbCB0aGUgcGFnZSBoYXMgYmVlbiBuYXZpZ2F0ZWRcbiAgICAgIGF3YWl0IHdhaXRGb3JGcmFtZVByb21pc2U7XG5cbiAgICAgIGF3YWl0IHRoaXMud2FpdEZvckRvbShEYXRlLm5vdygpLCBwYWdlTG9hZFZlcmlmeUhvb2spO1xuXG4gICAgICAvLyBlbmFibGUgY29uc29sZSBsb2dnaW5nLCBzbyB3ZSBnZXQgdGhlIGV2ZW50cyAob3RoZXJ3aXNlIHdlIG9ubHlcbiAgICAgIC8vIGdldCBub3RpZmllZCB3aGVuIG5hdmlnYXRpbmcgdG8gYSBsb2NhbCBwYWdlXG4gICAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdlbmFibGVDb25zb2xlJywge1xuICAgICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIH0pO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0aGlzLl9uYXZpZ2F0aW5nVG9QYWdlID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgd2FpdEZvckZyYW1lTmF2aWdhdGVkICgpIHtcbiAgICByZXR1cm4gYXdhaXQgbmV3IEIoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgbG9nLmRlYnVnKCdXYWl0aW5nIGZvciBmcmFtZSBuYXZpZ2F0ZWQgbWVzc2FnZS4uLicpO1xuICAgICAgbGV0IHN0YXJ0TXMgPSBEYXRlLm5vdygpO1xuXG4gICAgICAvLyBhZGQgYSBoYW5kbGVyIGZvciB0aGUgYFBhZ2UuZnJhbWVOYXZpZ2F0ZWRgIG1lc3NhZ2VcbiAgICAgIC8vIGZyb20gdGhlIHJlbW90ZSBkZWJ1Z2dlclxuICAgICAgY29uc3QgbmF2RXZlbnRMaXN0ZW5lciA9ICh2YWx1ZSkgPT4ge1xuICAgICAgICBsb2cuZGVidWcoYEZyYW1lIG5hdmlnYXRlZCBpbiAkeygoRGF0ZS5ub3coKSAtIHN0YXJ0TXMpIC8gMTAwMCl9cyBmcm9tOiAke3ZhbHVlfWApO1xuICAgICAgICBpZiAoIXRoaXMuYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZCAmJiAhdGhpcy5wYWdlTG9hZGluZykge1xuICAgICAgICAgIHJlc29sdmUodmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxvZy5kZWJ1ZygnRnJhbWUgbmF2aWdhdGVkIGJ1dCB3ZSB3ZXJlIHdhcm5lZCBhYm91dCBpdCwgbm90ICcgK1xuICAgICAgICAgICAgICAgICAgICAnY29uc2lkZXJpbmcgcGFnZSBzdGF0ZSB1bmxvYWRlZCcpO1xuICAgICAgICAgIHRoaXMuYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm5hdmlnYXRpb25EZWxheSkge1xuICAgICAgICAgIHRoaXMubmF2aWdhdGlvbkRlbGF5LmNhbmNlbCgpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdGhpcy5ycGNDbGllbnQuc2V0U3BlY2lhbE1lc3NhZ2VIYW5kbGVyKCdQYWdlLmZyYW1lTmF2aWdhdGVkJywgcmVqZWN0LCBuYXZFdmVudExpc3RlbmVyKTtcblxuICAgICAgLy8gdGltZW91dCwgaW4gY2FzZSByZW1vdGUgZGVidWdnZXIgZG9lc24ndCByZXNwb25kLFxuICAgICAgLy8gb3IgdGFrZXMgYSBsb25nIHRpbWVcbiAgICAgIGlmICghdGhpcy51c2VOZXdTYWZhcmkgfHwgdGhpcy5wYWdlTG9hZE1zID49IDApIHtcbiAgICAgICAgLy8gdXNlIHBhZ2VMb2FkTXMsIG9yIGEgc21hbGwgYW1vdW50IG9mIHRpbWVcbiAgICAgICAgbGV0IHRpbWVvdXQgPSB0aGlzLnVzZU5ld1NhZmFyaSA/IHRoaXMucGFnZUxvYWRNcyA6IDUwMDtcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uRGVsYXkgPSB1dGlsLmNhbmNlbGxhYmxlRGVsYXkodGltZW91dCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5uYXZpZ2F0aW9uRGVsYXk7XG4gICAgICAgICAgbmF2RXZlbnRMaXN0ZW5lcigndGltZW91dCcpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAvLyBub3RoaW5nIHRvIGRvOiB3ZSBvbmx5IGdldCBoZXJlIGlmIHRoZSByZW1vdGUgZGVidWdnZXJcbiAgICAgICAgICAvLyBhbHJlYWR5IG5vdGlmaWVkIG9mIGZyYW1lIG5hdmlnYXRpb24sIGFuZCB0aGUgZGVsYXlcbiAgICAgICAgICAvLyB3YXMgY2FuY2VsbGVkXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0VGltZWxpbmUgKGZuKSB7XG4gICAgbG9nLmRlYnVnKCdTdGFydGluZyB0byByZWNvcmQgdGhlIHRpbWVsaW5lJyk7XG4gICAgdGhpcy5ycGNDbGllbnQuc2V0VGltZWxpbmVFdmVudEhhbmRsZXIoZm4pO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzdGFydFRpbWVsaW5lJywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc3RvcFRpbWVsaW5lICgpIHtcbiAgICBsb2cuZGVidWcoJ1N0b3BwaW5nIHRvIHJlY29yZCB0aGUgdGltZWxpbmUnKTtcbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzdG9wVGltZWxpbmUnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBzdGFydENvbnNvbGUgKGZuKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIGxvZy5kZWJ1ZygnU3RhcnRpbmcgdG8gbGlzdGVuIGZvciBKYXZhU2NyaXB0IGNvbnNvbGUnKTtcbiAgICBpZiAoXy5pc0Z1bmN0aW9uKGZuKSkge1xuICAgICAgdGhpcy5ycGNDbGllbnQuc2V0Q29uc29sZUxvZ0V2ZW50SGFuZGxlcihmbik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc3RvcENvbnNvbGUgKCkge1xuICAgIGxvZy5kZWJ1ZygnU3RvcHBpbmcgdG8gbGlzdGVuIGZvciBKYXZhU2NyaXB0IGNvbnNvbGUnKTtcbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdkaXNhYmxlQ29uc29sZScsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0TmV0d29yayAoZm4pIHtcbiAgICBsb2cuZGVidWcoJ1N0YXJ0aW5nIHRvIGxpc3RlbiBmb3IgbmV0d29yayBldmVudHMnKTtcbiAgICB0aGlzLnJwY0NsaWVudC5zZXROZXR3b3JrTG9nRXZlbnRIYW5kbGVyKGZuKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnc3RhcnROZXR3b3JrJywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc3RvcE5ldHdvcmsgKCkge1xuICAgIGxvZy5kZWJ1ZygnU3RvcHBpbmcgdG8gbGlzdGVuIGZvciBuZXR3b3JrIGV2ZW50cycpO1xuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3N0b3BOZXR3b3JrJywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZXhlY3V0ZSAoY29tbWFuZCwgb3ZlcnJpZGUpIHtcbiAgICAvLyBpZiB0aGUgcGFnZSBpcyBub3QgbG9hZGVkIHlldCwgd2FpdCBmb3IgaXRcbiAgICBpZiAodGhpcy5wYWdlTG9hZGluZyAmJiAhb3ZlcnJpZGUpIHtcbiAgICAgIGxvZy5kZWJ1ZygnVHJ5aW5nIHRvIGV4ZWN1dGUgYnV0IHBhZ2UgaXMgbm90IGxvYWRlZC4nKTtcbiAgICAgIGF3YWl0IHRoaXMud2FpdEZvckRvbSgpO1xuICAgIH1cblxuICAgIGNvbnN0IGVycm9ycyA9IGNoZWNrUGFyYW1zKHthcHBJZEtleTogdGhpcy5hcHBJZEtleSwgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleX0pO1xuICAgIGlmIChlcnJvcnMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvcnMpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlKSB7XG4gICAgICBhd2FpdCB0aGlzLmdhcmJhZ2VDb2xsZWN0KCk7XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKGBTZW5kaW5nIGphdmFzY3JpcHQgY29tbWFuZDogJyR7Xy50cnVuY2F0ZShjb21tYW5kLCB7bGVuZ3RoOiA1MH0pfSdgKTtcbiAgICBsZXQgcmVzID0gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnc2VuZEpTQ29tbWFuZCcsIHtcbiAgICAgIGNvbW1hbmQsXG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gY29udmVydFJlc3VsdChyZXMpO1xuICB9XG5cbiAgYXN5bmMgY2FsbEZ1bmN0aW9uIChvYmpJZCwgZm4sIGFyZ3MpIHtcbiAgICBsZXQgZXJyb3JzID0gY2hlY2tQYXJhbXMoe2FwcElkS2V5OiB0aGlzLmFwcElkS2V5LCBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5fSk7XG4gICAgaWYgKGVycm9ycykgdGhyb3cgbmV3IEVycm9yKGVycm9ycyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcblxuICAgIGlmICh0aGlzLmdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlKSB7XG4gICAgICBhd2FpdCB0aGlzLmdhcmJhZ2VDb2xsZWN0KCk7XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKCdDYWxsaW5nIGphdmFzY3JpcHQgZnVuY3Rpb24nKTtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdjYWxsSlNGdW5jdGlvbicsIHtcbiAgICAgIG9iaklkLFxuICAgICAgZm4sXG4gICAgICBhcmdzLFxuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGNvbnZlcnRSZXN1bHQocmVzKTtcbiAgfVxuXG4gIHNldCBhbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkIChhbGxvdykge1xuICAgIHRoaXMuX2FsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQgPSBhbGxvdztcbiAgfVxuXG4gIGdldCBhbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkICgpIHtcbiAgICByZXR1cm4gdGhpcy5fYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZDtcbiAgfVxuXG4gIGFzeW5jIGdldENvb2tpZXMgKHVybHMpIHtcbiAgICBsb2cuZGVidWcoJ0dldHRpbmcgbmV0d29yayBjb29raWVzJyk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ2dldENvb2tpZXMnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICB1cmxzLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlQ29va2llIChjb29raWVOYW1lLCB1cmwpIHtcbiAgICBsb2cuZGVidWcoYERlbGV0aW5nIGNvb2tpZSAnJHtjb29raWVOYW1lfScgb24gJyR7dXJsfSdgKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnZGVsZXRlQ29va2llJywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgICAgY29va2llTmFtZSxcbiAgICAgIHVybCxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGdhcmJhZ2VDb2xsZWN0ICh0aW1lb3V0TXMgPSBHQVJCQUdFX0NPTExFQ1RfVElNRU9VVCkge1xuICAgIGxvZy5kZWJ1ZyhgR2FyYmFnZSBjb2xsZWN0aW5nIHdpdGggJHt0aW1lb3V0TXN9bXMgdGltZW91dGApO1xuICAgIGNvbnN0IGVycm9ycyA9IGNoZWNrUGFyYW1zKHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICB9KTtcbiAgICBpZiAoZXJyb3JzKSB7XG4gICAgICBsb2cuZGVidWcoYFVuYWJsZSB0byBjb2xsZWN0IGdhcmJhZ2UgYXQgdGhpcyB0aW1lYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgYXdhaXQgQi5yZXNvbHZlKHRoaXMucnBjQ2xpZW50LnNlbmQoJ2dhcmJhZ2VDb2xsZWN0Jywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgIH0pKS50aW1lb3V0KHRpbWVvdXRNcylcbiAgICAudGhlbihmdW5jdGlvbiBnY1N1Y2Nlc3MgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLXRoZW5cbiAgICAgIGxvZy5kZWJ1ZyhgR2FyYmFnZSBjb2xsZWN0aW9uIHN1Y2Nlc3NmdWxgKTtcbiAgICB9KS5jYXRjaChmdW5jdGlvbiBnY0Vycm9yIChlcnIpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by1jYWxsYmFja3NcbiAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBCLlRpbWVvdXRFcnJvcikge1xuICAgICAgICBsb2cuZGVidWcoYEdhcmJhZ2UgY29sbGVjdGlvbiB0aW1lZCBvdXQgYWZ0ZXIgJHt0aW1lb3V0TXN9bXNgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgVW5hYmxlIHRvIGNvbGxlY3QgZ2FyYmFnZTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHVzZUFwcERpY3RMb2NrIChmbikge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLl9sb2NrLmFjcXVpcmUoJ2FwcERpY3QnLCBmbik7XG4gIH1cbn1cblxuLy8gZXZlbnQgZW1pdHRlZCBwdWJsaWNhbGx5XG5SZW1vdGVEZWJ1Z2dlci5FVkVOVF9QQUdFX0NIQU5HRSA9ICdyZW1vdGVfZGVidWdnZXJfcGFnZV9jaGFuZ2UnO1xuUmVtb3RlRGVidWdnZXIuRVZFTlRfRlJBTUVTX0RFVEFDSEVEID0gJ3JlbW90ZV9kZWJ1Z2dlcl9mcmFtZXNfZGV0YWNoZWQnO1xuUmVtb3RlRGVidWdnZXIuRVZFTlRfRElTQ09OTkVDVCA9ICdyZW1vdGVfZGVidWdnZXJfZGlzY29ubmVjdCc7XG5cbi8vIGFkZCBnZW5lcmljIGNhbGxiYWNrc1xuZm9yIChjb25zdCBbbmFtZSwgaGFuZGxlcl0gb2YgXy50b1BhaXJzKG1lc3NhZ2VIYW5kbGVycykpIHtcbiAgUmVtb3RlRGVidWdnZXIucHJvdG90eXBlW25hbWVdID0gaGFuZGxlcjtcbn1cblxuZXhwb3J0IHtcbiAgUmVtb3RlRGVidWdnZXIsIFJFTU9URV9ERUJVR0dFUl9QT1JULCBSUENfUkVTUE9OU0VfVElNRU9VVF9NUyxcbn07XG4iXSwiZmlsZSI6ImxpYi9yZW1vdGUtZGVidWdnZXIuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
